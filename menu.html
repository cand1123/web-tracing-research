<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="unload=(), beforeunload=()">
    <title>Menu Utama</title>
    <link rel="icon" type="image/png" href="img.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Konfigurasi Tailwind untuk menghilangkan warning production
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
        
        // Suppress Tailwind production warning
        if (typeof window !== 'undefined') {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                if (args[0] && args[0].includes && args[0].includes('cdn.tailwindcss.com should not be used in production')) {
                    return; // Suppress this specific warning
                }
                originalWarn.apply(console, args);
            };
        }
    </script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem; /* 12px base */
            background-color: #f3f4f6;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Card hover effect - subtle */
        .menu-card {
            transition: all 0.2s ease;
            width: 100%;
            max-width: 220px;
            height: 100%;
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }
        
        .menu-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Card ketiga - solid/pakem */
        .menu-card-solid {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
            background-color: #ffffff !important;
            width: 100%;
            max-width: 220px;
            height: 100%;
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }
        
        .menu-card-solid:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2) !important;
        }
        
        /* Ensure grid items have same height */
        .grid > * {
            display: flex;
        }
        
    </style>
</head>
<body class="antialiased text-gray-800 flex items-center justify-center min-h-screen">
    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8 max-w-6xl w-full">
        <!-- Header: Title -->
        <div class="flex items-center justify-center mb-8">
            <div class="text-center">
                <h1 class="text-2xl sm:text-2xl font-bold text-gray-900 mb-1" style="font-size: 1.125rem;">Selamat Datang</h1>
                <p class="text-gray-600" style="font-size: 0.75rem;">Pilih menu untuk mengakses fitur yang tersedia</p>
            </div>
        </div>

        <!-- Menu Cards Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 justify-items-center">
            <!-- Card 1: Research List -->
            <a href="main-content.html" class="menu-card bg-white p-4 shadow-md flex flex-col items-center text-center">
                <div class="w-12 h-12 bg-indigo-100 flex items-center justify-center mb-3">
                    <i class="fas fa-book-open text-xl text-indigo-600"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1" style="font-size: 0.875rem;">Awur Research</h3>
                <p class="text-gray-600 mb-3" style="font-size: 0.6875rem;">Kelola data penelitian dan publikasi jurnal</p>
                <div class="mt-auto w-full">
                    <div class="inline-flex items-center text-indigo-600 font-medium" style="font-size: 0.6875rem;">
                        <span>Masuk</span>
                        <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </div>
            </a>

            <!-- Card 2: Proposal Internal -->
            <a href="main-proposal.html" class="menu-card bg-white p-4 shadow-md flex flex-col items-center text-center">
                <div class="w-12 h-12 bg-blue-100 flex items-center justify-center mb-3">
                    <i class="fas fa-file-alt text-xl text-blue-600"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1" style="font-size: 0.875rem;">Proposal Internal</h3>
                <p class="text-gray-600 mb-3" style="font-size: 0.6875rem;">Kelola proposal penelitian internal</p>
                <div class="mt-auto w-full">
                    <div class="inline-flex items-center text-blue-600 font-medium" style="font-size: 0.6875rem;">
                        <span>Masuk</span>
                        <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </div>
            </a>

            <!-- Card 3: Secure Logs -->
            <a href="paslog.html" class="menu-card menu-card-solid bg-white p-4 shadow-md flex flex-col items-center text-center">
                <div class="w-12 h-12 bg-green-100 flex items-center justify-center mb-3">
                    <i class="fas fa-lock text-xl text-green-600"></i>
                </div>
                <h3 class="font-bold text-gray-900 mb-1" style="font-size: 0.875rem;">Secure Logs</h3>
                <p class="text-gray-600 mb-3" style="font-size: 0.6875rem;">Simpan dan kelola password akun dengan aman</p>
                <div class="mt-auto w-full">
                    <div class="inline-flex items-center text-green-600 font-medium" style="font-size: 0.6875rem;">
                        <span>Masuk</span>
                        <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </div>
            </a>
        </div>

        <!-- Logout Button Below Grid -->
        <div class="mt-6 flex justify-end">
            <button onclick="handleLogout()"
                class="inline-flex items-center px-3 py-1.5 border border-red-500 text-red-600 text-xs font-medium bg-white hover:bg-red-50">
                <i class="fas fa-sign-out-alt mr-1"></i>
                Logout
            </button>
        </div>
    </div>

    <!-- Firebase v8 CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <!-- Firebase Config -->
    <script type="module">
        import { firebaseConfig } from './config.js';
        window.firebaseConfig = firebaseConfig;
    </script>

    <!-- Simple Header Script -->
    <script>
        function handleLogout() {
            try {
                // Clear session storage
                sessionStorage.removeItem('google_id_token');
                sessionStorage.removeItem('user_info');
                
                // Sign out from Firebase if available
                if (typeof firebase !== 'undefined' && firebase.auth) {
                    firebase.auth().signOut();
                }
                
                // Redirect to login page
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        window.handleLogout = handleLogout;
    </script>

    <!-- Authentication Check -->
    <script>
        // Check user session
        function checkUserSession() {
            try {
                const idToken = sessionStorage.getItem('google_id_token');
                const userInfo = sessionStorage.getItem('user_info');
                
                if (!idToken || !userInfo) {
                    redirectToLogin();
                    return false;
                }
                
                // Check if token is still valid
                const decodedToken = decodeJwt(idToken);
                const currentTime = Math.floor(Date.now() / 1000);
                
                if (decodedToken.exp && decodedToken.exp <= currentTime) {
                    clearSession();
                    redirectToLogin();
                    return false;
                }
                
                return true;
            } catch (error) {
                clearSession();
                redirectToLogin();
                return false;
            }
        }
        
        // Decode JWT token
        function decodeJwt(token) {
            const parts = String(token).split('.');
            if (parts.length < 2) throw new Error('Token tidak valid');
            const base64Url = parts[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const padded = base64 + '='.repeat((4 - (base64.length % 4)) % 4);
            const json = atob(padded);
            return JSON.parse(json);
        }
        
        // Clear session
        function clearSession() {
            try {
                sessionStorage.removeItem('google_id_token');
                sessionStorage.removeItem('user_info');
                if (typeof firebase !== 'undefined' && firebase.auth) {
                    firebase.auth().signOut();
                }
            } catch (e) {
                console.error('Error clearing session:', e);
            }
        }
        
        // Redirect to login
        function redirectToLogin() {
            window.location.href = 'index.html';
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check user session
            if (!checkUserSession()) {
                return;
            }
            
            // Initialize Firebase for auth state monitoring
            if (typeof firebase !== 'undefined' && window.firebaseConfig) {
                try {
                    if (!firebase.apps || firebase.apps.length === 0) {
                        firebase.initializeApp(window.firebaseConfig);
                    }
                    
                    // Monitor auth state
                    firebase.auth().onAuthStateChanged((user) => {
                        if (!user) {
                            redirectToLogin();
                        }
                    });
                } catch (error) {
                    console.error('Firebase initialization error:', error);
                }
            }
        });
    </script>

</body>
</html>

