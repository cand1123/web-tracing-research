<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="unload=(), beforeunload=()">
    <title>Proposal Internal</title>
    <!-- Tempel gambar img.png di tampilan -->
    <link rel="icon" type="image/png" href="img.png">
    <!-- Tailwind CSS - Production Ready -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Konfigurasi Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
        
        // Suppress Tailwind production warning untuk development
        if (typeof window !== 'undefined') {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                if (args[0] && args[0].includes && args[0].includes('cdn.tailwindcss.com should not be used in production')) {
                    return; // Suppress warning untuk development
                }
                originalWarn.apply(console, args);
            };
        }
    </script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem; /* 12px base */
            background-color: #f3f4f6;
        }
            
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
            /* Table layout */
        .fixed-table {
            table-layout: auto;
            width: 100%;
            border-collapse: collapse;
            min-width: 100%;
        }
        
        .fixed-table th,
        .fixed-table td {
            white-space: normal;
            word-wrap: break-word;
            word-break: break-word;
            hyphens: auto;
            max-width: 100% !important;
            width: auto !important;
            min-width: 0 !important;
        }
        
            /* Column sizing - HANCURKAN SEMUA BATASAN! */
        .col-no {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            text-align: center;
        }
        
        .col-title {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            white-space: normal !important;
            word-wrap: break-word !important;
            text-transform: capitalize !important;
            text-align: left;
        }
            
        .col-accreditation {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            text-align: center;
            white-space: normal !important;
            word-wrap: break-word !important;
        }
            
        .col-status {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            text-align: center;
        }
            
        .col-year {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            text-align: center;
        }
            
        .col-actions {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            text-align: center;
        }
        
        .col-journal-link {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            text-align: center;
            white-space: nowrap !important;
        }
        
        .col-doc-link {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            text-align: center;
            white-space: nowrap !important;
        }
        
        .col-year-published {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            text-align: center;
        }
        
        .col-published-link {
            width: auto !important;
            min-width: 0 !important;
            max-width: 100% !important;
            text-align: center;
            white-space: nowrap !important;
        }
        
        .col-notes {
            width: auto !important;
            min-width: 0 !important;
            max-width: 200px !important;
            text-align: left;
            white-space: normal !important;
            word-wrap: break-word !important;
        }
            
            /* Table styling */
        .table_component {
            width: 100%;
            max-width: 100% !important;
        }
        
        /* Mobile styles - hanya untuk hp */
        @media (max-width: 640px) {
            .table_component {
                width: 100% !important;
            }
            
            .fresh-table {
                min-width: 100% !important;
                width: 100% !important;
                font-size: 0.6875rem !important; /* 11px */
            }
            
            .fresh-table td, .fresh-table th {
                padding: 6px 4px !important;
                white-space: normal !important;
                word-wrap: break-word !important;
                word-break: break-word !important;
                font-size: 0.6875rem !important; /* 11px */
                line-height: 1.3 !important;
            }
            
            /* Kolom Nama Dosen - lebih besar */
            .fresh-table td:nth-child(1),
            .fresh-table th:nth-child(1) {
                width: 25% !important;
                min-width: 100px !important;
                max-width: 150px !important;
                text-align: center !important;
                font-size: 0.6875rem !important; /* 11px */
            }
            
            /* Kolom Judul - paling besar */
            .fresh-table td:nth-child(2),
            .fresh-table th:nth-child(2) {
                width: 45% !important;
                min-width: 150px !important;
                max-width: none !important;
                white-space: normal !important;
                word-wrap: break-word !important;
                word-break: break-word !important;
                font-size: 0.6875rem !important; /* 11px */
                line-height: 1.3 !important;
            }
            
            /* Kolom Pelaksanaan - lebih kecil */
            .fresh-table td:nth-child(3),
            .fresh-table th:nth-child(3) {
                width: 15% !important;
                min-width: 80px !important;
                max-width: 100px !important;
                text-align: center !important;
                font-size: 0.6875rem !important; /* 11px */
            }
            
            /* Kolom Aksi - lebih kecil */
            .fresh-table td:nth-child(4),
            .fresh-table th:nth-child(4) {
                width: 6% !important;
                min-width: 40px !important;
                max-width: 80px !important;
                text-align: center !important;
            }
            
            /* Button aksi lebih kecil */
            .fresh-button {
                padding: 2px !important;
                min-width: 20px !important;
                height: 20px !important;
                font-size: 0.6875rem !important; /* 11px */
            }
            
            /* Badge lebih kecil */
            .fresh-badge {
                padding: 2px 4px !important;
                font-size: 0.6875rem !important; /* 11px */
                border-radius: 8px !important;
            }
            
            .accreditation-badge {
                font-size: 0.6875rem !important; /* 11px */
                padding: 2px 4px !important;
            }
        }
        
        .fresh-table {
            border: 1px solid #dededf;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            text-align: left;
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0;
            table-layout: auto;
            min-width: 100%;
            max-width: 100%;
        }

        .fresh-table td, .fresh-table th {
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
            padding: 12px 16px;
            vertical-align: top;
            max-width: 100% !important;
            width: auto !important;
            min-width: 0 !important;
        }

        /* Khusus untuk kolom judul - biarkan wrap */
        .fresh-table td:nth-child(2),
        .fresh-table th:nth-child(2) {
            white-space: normal !important;
            word-wrap: break-word !important;
            word-break: break-word !important;
        }

        /* Untuk kolom lainnya - nowrap */
        .fresh-table td:not(:nth-child(2)),
        .fresh-table th:not(:nth-child(2)) {
            white-space: nowrap !important;
        }
            
            /* Body styling */
        .fresh-body tr {
            border: 1px solid #e5e7eb;
        }
        
        .fresh-body tr:hover {
                background: #f8fafb;
            }
            
            .fresh-body td {
                padding: 12px 16px;
                border: none;
                vertical-align: top;
                font-size: 0.6875rem; /* 11px */
                min-height: 50px;
                background-color: #ffffff;
                color: #000000;
                border: 1px solid #e5e7eb;
                box-sizing: border-box;
                word-wrap: break-word;
                word-break: break-word;
                white-space: normal;
                max-width: 100% !important;
                width: auto !important;
                min-width: 0 !important;
            }
            
            /* Row styling */
        .table-row {
            background: #ffffff;
            margin: 2px 0;
            border: 1px solid #e5e7eb;
                height: 3.5rem;
                min-height: 3.5rem;
                max-height: 3.5rem;
        }
        
        .table-row:nth-child(even) {
            background: #f8fafc;
        }
        
        .table-row:nth-child(odd) {
            background: #ffffff;
            }
            
            .table-row:hover {
                background-color: #f9fafb;
            }
            
        .table-row td {
                padding: 12px 16px;
            background-color: transparent;
            color: #374151;
            font-weight: 600;
            border: none;
                min-height: 3.5rem;
                box-sizing: border-box;
                border-bottom: 1px solid #f3f4f6;
                word-wrap: break-word;
                word-break: break-word;
                white-space: normal;
                vertical-align: top;
                max-width: 100% !important;
                width: auto !important;
                min-width: 0 !important;
            }
            

        
            /* Collapse styling removed - no longer needed */
            
            /* Badge styling */
            .fresh-badge {
                padding: 4px 8px;
                font-size: 0.6875rem; /* 11px */
                font-weight: 500;
                letter-spacing: 0.2px;
                text-transform: uppercase;
                border: none;
                display: inline-block;
                line-height: 1.4;
                border-radius: 12px;
                margin: 0;
            }
            
            .fresh-badge.published {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
            border: 2px solid #86efac;
            box-shadow: 0 4px 8px rgba(34, 197, 94, 0.2);
        }
        
            .fresh-badge.review {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 2px solid #fcd34d;
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.2);
        }
        
            .fresh-badge.submit {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border: 2px solid #93c5fd;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.2);
        }
        
            .fresh-badge.writing {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: #0c4a6e;
            border: 2px solid #7dd3fc;
            box-shadow: 0 4px 8px rgba(14, 165, 233, 0.2);
        }
        
            .fresh-badge.declined {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 2px solid #fca5a5;
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.2);
        }
        
            /* Accreditation badges */
            .accreditation-badge {
                color: #374151;
                font-size: 0.6875rem; /* 11px */
                font-weight: 500;
                text-transform: capitalize !important;
                text-align: center;
            }
            
        .accreditation-sinta1 {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 2px solid #fcd34d;
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.2);
        }
        
        .accreditation-sinta2 {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border: 2px solid #93c5fd;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.2);
        }
        
        .accreditation-sinta3 {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
            border: 2px solid #86efac;
            box-shadow: 0 4px 8px rgba(34, 197, 94, 0.2);
        }
        
        .accreditation-sinta4 {
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            color: #7c3aed;
            border: 2px solid #c4b5fd;
            box-shadow: 0 4px 8px rgba(139, 92, 246, 0.2);
        }
        
        .accreditation-q1 {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 2px solid #fcd34d;
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.2);
        }
        
        .accreditation-q2 {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border: 2px solid #93c5fd;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.2);
        }
        
        .accreditation-q3 {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
            border: 2px solid #86efac;
            box-shadow: 0 4px 8px rgba(34, 197, 94, 0.2);
        }
        
        .accreditation-q4 {
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            color: #7c3aed;
            border: 2px solid #c4b5fd;
            box-shadow: 0 4px 8px rgba(139, 92, 246, 0.2);
        }
        
            /* Button styling */
        .fresh-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
                padding: 3px;
            border: none;
            font-size: 0.75rem;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            min-width: 1.5rem;
            height: 1.5rem;
                background: transparent;
                color: #6b7280;
            }
            
            .fresh-button:hover {
                background: transparent;
                color: #374151;
            }
            
            
            .fresh-button.view-btn.expanded i {
                transform: rotate(180deg);
            }
            
            /* View button styles removed - no longer needed */
            
            /* Pagination styling */
        .fresh-pagination-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
                padding: 6px 12px;
            border: 1px solid #e5e7eb;
                background: white;
            color: #374151;
                font-size: 0.6875rem; /* 11px */
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            min-width: 1.5rem;
            height: 1.5rem;
                border-radius: 4px;
        }
        
        .fresh-pagination-btn:hover:not(:disabled) {
                background: #f3f4f6;
                border-color: #d1d5db;
        }
        
        .fresh-pagination-btn.active {
                background: #667eea;
                color: white;
                border-color: #667eea;
        }
        
        .fresh-pagination-btn.active:hover {
                background: #5a67d8;
            color: #000000;
        }
        
            .fresh-pagination-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            
            /* Select styling */
        .fresh-select {
                padding: 4px 6px;
                border: 1px solid #e5e7eb;
                background: white;
                font-size: 0.6875rem; /* 11px */
            color: #374151;
                cursor: pointer;
                border-radius: 4px;
                height: 1.5rem;
                min-height: 1.5rem;
                width: auto;
                min-width: 50px;
        }

        /* Khusus untuk dropdown pagination */
        #items-per-page {
            width: 60px !important;
            min-width: 60px !important;
            max-width: 60px !important;
            padding: 4px 4px !important;
        }
        
        .fresh-select:focus {
            outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
            }
            
        
            /* Text styling */
            .text-wrap {
                white-space: normal !important;
                word-wrap: break-word !important;
                line-height: 1.4 !important;
            text-transform: capitalize !important;
        }

        .status-text {
            color: #374151;
            font-size: 12px;
            font-weight: 500;
            text-transform: capitalize !important;
            text-align: center;
        }

            /* Input styling */
        .fresh-input {
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            padding: 6px 8px;
            background: white;
        }
        
        .fresh-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }
        
        .border-red-300 {
            border-color: #fca5a5 !important;
        }
        
        .border-red-300:focus {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
            /* Modal styling */
        .fresh-modal {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
        }
        
        .fresh-modal-content {
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            border: none;
        }
        
            /* Card styling */
                    .fresh-card {
                background: white;
                border-radius: 6px;
            padding: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
                border: 1px solid #f3f4f6;
            }
            
            /* Header banner styling */
        .full-width-header {
            margin-left: 0;
            margin-right: 0;
            width: 100%;
        }
        
        .header-banner {
            background: #1e3a8a;
            min-height: 200px;
            position: relative;
            display: flex;
            align-items: center;
            padding: 2rem 4rem;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .logo-container {
            flex-shrink: 0;
        }
        
        .hexagon-logo {
            width: 60px;
            height: 60px;
            background: white;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .logo-text {
            font-size: 1.125rem; /* 18px */
            font-weight: bold;
            color: #1e3a8a;
        }
        
        .brand-text {
            color: white;
        }
        
        .brand-title {
            font-size: 1.125rem; /* 18px */
            font-weight: bold;
            margin: 0;
            letter-spacing: 1px;
        }
        
        .brand-tagline {
            font-size: 0.75rem; /* 12px */
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            letter-spacing: 0.5px;
        }
        
        .header-right {
            flex-shrink: 0;
        }
        
        .brain-graphic {
            width: 200px;
            height: 120px;
        }
        
        .brain-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }
        
        .city-silhouette {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.3) 0%, transparent 100%);
            clip-path: polygon(
                0% 100%, 5% 80%, 10% 90%, 15% 70%, 20% 85%, 25% 60%, 30% 75%, 35% 50%, 
                40% 65%, 45% 40%, 50% 55%, 55% 30%, 60% 45%, 65% 20%, 70% 35%, 75% 10%, 
                80% 25%, 85% 5%, 90% 15%, 95% 0%, 100% 10%, 100% 100%
            );
        }
        
        /* Responsive styles */
            @media (min-width: 640px) {
                .fresh-body td {
                    padding: 8px 8px;
                    height: 54px;
                    min-height: 54px;
                }
                
                .fresh-badge {
                    padding: 5px 10px;
                    letter-spacing: 0.3px;
                }
                
                .fresh-button {
                    padding: 4px;
                }
                
                .fresh-pagination-btn {
                    padding: 8px 16px;
                    font-size: 0.6875rem; /* 11px */
                }
                
                .fresh-select {
                    padding: 4px 8px;
                    font-size: 0.6875rem; /* 11px */
                }
                
                .fresh-input {
                    border-radius: 8px;
                    padding: 8px 10px;
                }
                
                .fresh-modal-content {
                    border-radius: 14px;
                }
                
                .fresh-collapse {
                    border-radius: 8px;
                    margin: 4px 6px;
                }
                
                .fresh-card {
                    border-radius: 8px;
                    padding: 12px;
                }
            }
            
            @media (min-width: 768px) {
                .fresh-body td {
                    padding: 10px 12px;
                    height: 58px;
                    min-height: 58px;
                }
                
                .fresh-badge {
                    padding: 6px 12px;
                    letter-spacing: 0.3px;
                }
                
                .fresh-button {
                    padding: 5px;
                }
                
                .fresh-pagination-btn {
                    padding: 10px 20px;
                    font-size: 0.6875rem; /* 11px */
                }
                
                .fresh-select {
                    padding: 6px 10px;
                    font-size: 0.6875rem; /* 11px */
                }
                
                .fresh-input {
                    border-radius: 10px;
                    padding: 10px 12px;
                }
                
                .fresh-modal-content {
                    border-radius: 16px;
                }
                
                .fresh-collapse {
                    border-radius: 10px;
                    margin: 6px 8px;
                }
                
                .fresh-card {
                    border-radius: 10px;
                    padding: 16px;
                }
            }
            
        @media (max-width: 768px) {
            .header-banner {
                padding: 1.5rem 2rem;
                min-height: 150px;
            }
            
            .brand-title {
                font-size: 1.125rem; /* 18px */ /* 24px */
            }
            
            .brand-tagline {
                font-size: 0.75rem; /* 12px */
            }
            
            .hexagon-logo {
                width: 50px;
                height: 50px;
            }
            
            .logo-text {
                font-size: 1.125rem; /* 18px */
            }
            
            .brain-graphic {
                width: 150px;
                height: 90px;
            }
        }
        
        @media (max-width: 640px) {
            .header-banner {
                padding: 1rem;
                min-height: 120px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .header-left {
                flex-direction: column;
                gap: 1rem;
            }
            
            .brand-title {
                font-size: 1.125rem; /* 18px */
            }
            
            .brain-graphic {
                width: 120px;
                height: 72px;
            }
        
            .container {
                padding-left: 8px;
                padding-right: 8px;
                max-width: 100% !important;
                width: 100% !important;
            }
            
            .text-xs {
                font-size: 0.75rem;
            }
            
            .btn-transition {
                min-height: 44px;
            }
            
            .modal-content {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
            }

            /* Autocomplete Styles */
            .autocomplete-item.active {
                background-color: #f3f4f6;
            }
            
            .autocomplete-item:hover {
                background-color: #f9fafb;
            }
            
            #title-autocomplete {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            
            /* Journal Autocomplete Results Font Size */
            #journal-autocomplete-results > div > div {
                font-size: 0.6875rem !important; /* 11px */
            }
            
            .grid-cols-1 {
                grid-template-columns: 1fr;
            }
            
            .space-y-2 > * + * {
                margin-top: 0.5rem;
            }
            
            /* Pagination mobile */
            .fresh-pagination-btn {
                padding: 4px 6px !important;
                font-size: 0.6875rem !important; /* 11px */
                min-width: 24px !important;
                height: 24px !important;
            }
            
            
            /* Collapse mobile */
            .collapse-transition td {
                padding: 8px 12px !important;
                font-size: 0.6875rem !important; /* 11px */
            }
            
            /* Detail mobile */
            .detail-mobile {
                padding: 6px 8px !important;
                font-size: 0.6875rem !important; /* 11px */
            }
        }
        
        @media (max-width: 475px) {
                .fresh-table {
                    font-size: 0.6875rem !important; /* 11px */
                }
                
                .fresh-table td, .fresh-table th {
                    padding: 4px 2px !important;
                    font-size: 0.6875rem !important; /* 11px */
                    line-height: 1.2 !important;
                }
                
                /* Kolom Nama Dosen - lebih besar */
                .fresh-table td:nth-child(1),
                .fresh-table th:nth-child(1) {
                    width: 25% !important;
                    min-width: 80px !important;
                    max-width: 100px !important;
                    font-size: 0.6875rem !important; /* 11px */
                }
                
                /* Kolom Judul - paling besar */
                .fresh-table td:nth-child(2),
                .fresh-table th:nth-child(2) {
                    width: 45% !important;
                    min-width: 120px !important;
                    font-size: 0.6875rem !important; /* 11px */
                }
                
                /* Kolom Pelaksanaan - lebih kecil */
                .fresh-table td:nth-child(3),
                .fresh-table th:nth-child(3) {
                    width: 15% !important;
                    min-width: 70px !important;
                    max-width: 80px !important;
                    font-size: 0.6875rem !important; /* 11px */
                }
            }
            
            /* Remove border radius from all elements */
            select, input {
                border-radius: 0 !important;
            }
            
            /* Collapse styling */
        .collapse-transition {
                background-color: #f8fafc;
            height: auto;
            min-height: 0;
                margin: 3px 4px;
                border: 1px solid #e5e7eb;
        }
        
        .collapse-transition.hidden {
            height: 0;
            min-height: 0;
        }
        
            .collapse-transition.expanded {
                background-color: #f1f5f9;
                max-height: 500px;
                opacity: 1;
            }
            
        .collapse-transition td {
            padding: 0.75rem 1.5rem;
            box-sizing: border-box;
                height: auto;
                min-height: auto;
            }
            
            /* Styling untuk tombol dokumen */
            .doc-view-btn {
                background: transparent;
                border: none;
                color: #2563eb;
                text-decoration: underline;
                cursor: pointer;
                font-size: inherit;
                padding: 0;
                margin-left: 0.5rem;
            }
            
            .doc-view-btn:hover {
                color: #1d4ed8;
            }
            
            /* Body container padding */
            body > div.bg-white.shadow-lg {
                padding-left: 24px;
                padding-right: 24px;
            }
            
            /* Styling untuk detail cards - kembali ke layout flex-wrap */
            
            /* Filter styling */
        .filter-select, .filter-button {
            display: block;
            width: 100%;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            line-height: 1.5;
            color: #374151;
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        .filter-select:focus, .filter-button:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
        }
        
        .filter-button {
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .filter-button:hover {
            background-color: #f9fafb;
        }
        
        .filter-dropdown {
            position: absolute;
            z-index: 10;
            margin-top: 0.25rem;
            width: 100%;
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* Mobile filter styles */
        @media (max-width: 640px) {
            .filter-select, .filter-button {
                font-size: 0.6875rem !important; /* 11px */
                height: 32px !important;
                min-height: 32px !important;
            }
        }
    </style>
    
</head>
<body class="antialiased text-gray-800">
        <!-- Back Button Header -->
        <div class="bg-white shadow-sm border-b border-gray-200 py-5 px-4 flex justify-between items-center">
            <a href="menu.html" class="inline-flex items-center text-gray-700 hover:text-indigo-600 transition-colors">
                <i class="fas fa-arrow-left mr-2 text-sm"></i>
                <span class="text-sm font-medium">Kembali ke Menu</span>
            </a>
            <button onclick="handleLogout()" class="inline-flex items-center text-red-600 hover:text-red-700 transition-colors">
                <i class="fas fa-sign-out-alt mr-2 text-sm"></i>
                <span class="text-sm font-medium">Logout</span>
            </button>
        </div>

        <!-- Filter Section -->
        <div class="bg-gray-50 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6 border border-gray-200">
            <!-- Desktop Filter (hidden on mobile) -->
            <div class="hidden sm:flex flex-col gap-3 sm:gap-4">
                <!-- Filter Fields -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <div>
                        <label for="title-search" class="block text-xs font-medium text-gray-700 mb-1">Search Judul</label>
                        <input type="text" id="title-search" placeholder="Cari berdasarkan judul..." class="filter-select" autocomplete="off">
                    </div>
                    <div>
                        <label for="year-filter" class="block text-xs font-medium text-gray-700 mb-1">Filter Tahun</label>
                        <select id="year-filter" class="filter-select" autocomplete="off">
                            <option value="">Semua Tahun</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Filter Toggle Button (visible only on mobile) -->
        <div class="sm:hidden mb-4">
            <button id="mobile-filter-toggle" class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700">
                <i class="fas fa-filter"></i>
                <span>Filter & Search</span>
                <i class="fas fa-chevron-right" id="mobile-filter-icon"></i>
            </button>
        </div>
        
        <!-- Mobile Filter Sidebar -->
        <div id="mobile-filter-sidebar" class="fixed inset-y-0 right-0 w-80 bg-white shadow-2xl translate-x-full z-50 sm:hidden">
            <div class="flex flex-col h-full">
                <!-- Header -->
                <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50">
                    <h3 class="text-lg font-semibold text-gray-800">Filter & Search</h3>
                    <button id="mobile-filter-close" class="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg">
                        <i class="fas fa-times text-lg"></i>
                    </button>
                </div>
                
                <!-- Filter Content -->
                <div class="flex-1 p-4 space-y-4">
                    <!-- Search Fields -->
                    <div class="space-y-3">
                        <h4 class="text-sm font-medium text-gray-700 border-b border-gray-200 pb-2">Search</h4>
                        <div>
                            <label for="mobile-title-search" class="block text-xs font-medium text-gray-700 mb-1">Search Judul</label>
                            <input type="text" id="mobile-title-search" placeholder="Cari berdasarkan judul..." class="filter-select w-full" autocomplete="off">
                        </div>
                    </div>
                    
                    <!-- Year Filter -->
                    <div class="space-y-3">
                        <h4 class="text-sm font-medium text-gray-700 border-b border-gray-200 pb-2">Filter Tahun</h4>
                        <div>
                            <label for="mobile-year-filter" class="block text-xs font-medium text-gray-700 mb-1">Tahun</label>
                            <select id="mobile-year-filter" class="filter-select w-full" autocomplete="off">
                                <option value="">Semua Tahun</option>
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                            </select>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>

        <!-- Main Content: Table -->
        <div class="bg-white shadow-lg">
            <div class="pt-4 px-2">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-1 sm:gap-2 mb-2 sm:mb-3">
                    <h2 class="text-sm sm:text-base md:text-lg font-semibold">Research List</h2>
                    <div class="flex gap-2">
                        <button id="add-research-btn" class=" w-full sm:w-auto inline-flex items-center justify-center px-1.5 py-1 sm:px-2 sm:py-1.5 border border-transparent text-xs font-medium shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <i class="fas fa-plus mr-1 sm:mr-1.5 text-xs"></i>
                            <span class="hidden xs:inline">Tambah Penelitian Baru</span>
                            <span class="xs:hidden">Tambah</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="px-2 pb-2">
                <div class="table_component" role="region" tabindex="0">
                    <table class="w-full fresh-table fixed-table">
                        <thead class="fresh-header">
                            <tr class="hover:bg-gray-50 table-row">
                                    <th scope="col" class="px-0 py-0 text-xs font-bold text-gray-600 text-center">Nama Dosen</th>
                                    <th scope="col" class="px-0 py-0 text-xs font-bold text-gray-600">Judul</th>
                                    <th scope="col" class="px-0 py-0 text-xs font-bold text-gray-600 text-center">Pelaksanaan</th>
                                    <th scope="col" class="px-0 py-0 text-xs font-bold text-gray-600 text-center">Aksi</th>
                            </tr>
                        </thead>
                                             <tbody id="research-table-body" class="fresh-body">
                         <!-- Data akan diisi oleh JavaScript -->
                         <tr class="table-row">
                             <td colspan="4" class="px-6 py-8 text-center text-gray-400">
                                 <div id="loading-spinner" role="status">
                                     <svg aria-hidden="true" class="inline w-5 h-5 text-gray-200 animate-spin fill-gray-400" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                                         <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>
                                         <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0492C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>
                                     </svg>
                                     <span class="sr-only">Loading...</span>
                                 </div>
                                 <p id="no-data-message" class="hidden text-xs text-gray-400">Data penelitian tidak ditemukan. Tambahkan data baru menggunakan form di bawah.</p>
                             </td>
                         </tr>
                     </tbody>
                    </table>
                </div>
                
                <!-- Pagination Navigation -->
                <div id="pagination-container" class="mt-3 flex flex-col sm:flex-row items-center justify-between gap-3 bg-gray-50 p-3 rounded-lg border">
                    <!-- Info Halaman -->
                    <div class="text-xs text-gray-600 font-medium">
                        <span id="page-info">Menampilkan 1-10 dari 0 data</span>
                    </div>
                    
                    <!-- Navigasi Halaman -->
                    <div class="flex items-center gap-1">
                        <!-- Tombol Previous -->
                        <button id="prev-page" class="fresh-pagination-btn disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-chevron-left text-xs"></i>
                            <span class="hidden sm:inline ml-1 text-xs">Prev</span>
                        </button>
                        
                        <!-- Nomor Halaman -->
                        <div id="page-numbers" class="flex items-center gap-1">
                            <!-- Nomor halaman akan di-generate di sini -->
                        </div>
                        
                        <!-- Tombol Next -->
                        <button id="next-page" class="fresh-pagination-btn disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <span class="hidden sm:inline mr-1 text-xs">Next</span>
                            <i class="fas fa-chevron-right text-xs"></i>
                        </button>
                    </div>
                    
                    <!-- Dropdown Items per Page -->
                    <div class="flex items-center gap-1">
                        <label class="text-xs text-gray-600 font-medium whitespace-nowrap">Per halaman:</label>
                        <select id="items-per-page" class="fresh-select" style="width: 60px !important; min-width: 60px !important; max-width: 60px !important;" autocomplete="off">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="15">15</option>
                            <option value="20">20</option>
                            <option value="25">25</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Add/Edit Research Modal -->
        <div id="researchModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden" style="z-index: 9999;">
            <div class="flex items-center justify-center min-h-screen p-2 sm:p-4">
                <div class="relative w-full max-w-3xl p-3 sm:p-4 border shadow-lg rounded-md bg-white modal-content">
                    <div class="flex justify-between items-center pb-2 border-b">
                        <h3 id="modal-title" class="text-base sm:text-lg font-semibold text-gray-900">Tambah Penelitian Baru</h3>
                        <button id="closeResearchModal" class=" text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mt-4">
                        <form id="research-form" class="space-y-3" autocomplete="off">
                            <input type="hidden" id="edit-key" name="edit-key" autocomplete="off">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label for="lecturer_name" class="block text-xs font-medium text-gray-700">Nama Dosen</label>
                                    <input type="text" id="lecturer_name" name="lecturer_name" required class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ketik disini..." autocomplete="off">
                                </div>
                                <div>
                                    <label for="implementation_period" class="block text-xs font-medium text-gray-700">Pelaksanaan</label>
                                    <select id="implementation_period" name="implementation_period" required class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" autocomplete="off">
                                        <option value="">Pilih Tahun</option>
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <label for="title" class="block text-xs font-medium text-gray-700">Judul</label>
                                    <input type="text" id="title" name="title" required class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ketik disini..." autocomplete="off">
                                </div>
                            </div>
                            
                            <!-- Link Jurnal - Di bawah Judul tanpa grid -->
                            <div class="mt-4">
                                <label for="journal_link" class="block text-xs font-medium text-gray-700">Link Jurnal</label>
                                <div class="relative">
                                    <input type="url" id="journal_link" name="journal_link" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ketik disini..." autocomplete="off">
                                    <!-- Autocomplete Dropdown -->
                                    <div id="journal-autocomplete" class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg hidden max-h-60 overflow-y-auto">
                                        <div id="journal-autocomplete-loading" class="px-3 py-2 text-sm text-gray-500 hidden">
                                            <i class="fas fa-spinner fa-spin mr-2"></i>Mencari...
                                        </div>
                                        <div id="journal-autocomplete-results" class="py-1">
                                            <!-- Results will be populated here -->
                                        </div>
                                        <div id="journal-autocomplete-no-results" class="px-3 py-2 text-sm text-gray-500 hidden">
                                            <i class="fas fa-search mr-2"></i>Tidak ada hasil ditemukan
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Grid untuk field lainnya -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-4">
                                <div>
                                    <label for="hki_link" class="block text-xs font-medium text-gray-700">Link HKI</label>
                                    <input type="url" id="hki_link" name="hki_link" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ketik disini..." autocomplete="off">
                                </div>
                                <div>
                                    <label for="media_link" class="block text-xs font-medium text-gray-700">Link Media Massa</label>
                                    <input type="url" id="media_link" name="media_link" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ketik disini..." autocomplete="off">
                                </div>
                                <div>
                                    <label for="work_folder" class="block text-xs font-medium text-gray-700">Folder Kerja</label>
                                    <input type="text" id="work_folder" name="work_folder" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ketik disini..." autocomplete="off">
                                </div>
                                <div>
                                    <label for="total_grant" class="block text-xs font-medium text-gray-700">Total Hibah</label>
                                    <div class="relative">
                                        <span class="absolute left-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500">Rp</span>
                                        <input type="text" id="total_grant" name="total_grant" class="mt-1 block w-full pl-8 pr-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="0" oninput="formatCurrency(this)" autocomplete="off">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Catatan - Field Terpisah -->
                            <div class="mt-4">
                                <label for="notes" class="block text-xs font-medium text-gray-700">Catatan</label>
                                <textarea id="notes" name="notes" rows="3" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ketik disini..." autocomplete="off"></textarea>
                            </div>
                            
                        </div>
                        <div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 pt-3 border-t">
                            <button type="button" id="cancel-btn" class=" w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 sm:py-1.5 border border-red-300 text-xs font-medium text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                Batal
                            </button>
                            <button type="submit" id="submit-btn" class=" w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 sm:py-1.5 border border-transparent text-xs font-medium shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Tambah Penelitian
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        

    </div>

    <!-- Modal for Details -->
    <div id="detailModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50">
        <div class="relative top-10 sm:top-20 mx-auto p-3 sm:p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-xl sm:text-2xl font-bold text-gray-900">Research Details</h3>
                <button id="closeDetailModal" class=" text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="mt-3">
                <pre id="modal-content" class="bg-gray-100 p-3 sm:p-4 rounded-lg text-xs sm:text-sm whitespace-pre-wrap break-all"></pre>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal for Delete -->
    <div id="deleteConfirmModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50 flex items-center justify-center">
        <div class="relative mx-auto p-4 border w-full max-w-sm shadow-lg rounded-md bg-white">
            <div class="mt-2 text-center">
                <div class="mx-auto flex items-center justify-center h-10 w-10 rounded-full bg-red-100">
                    <i class="fas fa-exclamation-triangle text-red-600"></i>
                </div>
                <h3 class="text-sm font-medium text-gray-900 mt-2">Hapus Data Penelitian</h3>
                <div class="mt-2 px-3 py-2">
                    <p class="text-xs text-gray-500">Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.</p>
                </div>
                <div class="items-center px-3 py-2 space-y-2 sm:space-y-0 sm:space-x-3">
                    <button id="confirmDeleteBtn" class="w-full sm:w-auto px-3 py-1.5 bg-red-600 text-white text-xs font-medium rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                        Hapus
                    </button>
                    <button id="cancelDeleteBtn" class="w-full sm:w-auto px-3 py-1.5 bg-gray-200 text-gray-800 text-xs font-medium rounded-md shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- VLookup Modal -->
    <div id="vlookupModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-2 sm:p-4">
            <div class="relative w-full max-w-6xl p-3 sm:p-4 border shadow-lg rounded-md bg-white modal-content">
                <div class="flex justify-between items-center pb-2 border-b">
                    <h3 id="vlookup-modal-title" class="text-base sm:text-lg font-semibold text-gray-900">Cari Dokumen dari Database</h3>
                    <button id="closeVlookupModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-4">
                    <!-- Database Selection -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Database:</label>
                        <div class="flex gap-4">
                            <label class="flex items-center">
                                <input type="radio" name="database-source" value="pustakana" checked class="mr-2">
                                <span class="text-sm">Pustakana</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="database-source" value="research" class="mr-2">
                                <span class="text-sm">Research</span>
                            </label>
                        </div>
                    </div>
                    
                    
                    <!-- Data Table -->
                    <div class="overflow-x-auto max-h-96 border border-gray-200 rounded">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-3 py-2 text-left font-medium text-gray-700">ID</th>
                                    <th class="px-3 py-2 text-left font-medium text-gray-700">Judul</th>
                                    <th class="px-3 py-2 text-left font-medium text-gray-700">Status</th>
                                    <th class="px-3 py-2 text-left font-medium text-gray-700">Tahun</th>
                                    <th class="px-3 py-2 text-left font-medium text-gray-700">Link Jurnal</th>
                                    <th class="px-3 py-2 text-left font-medium text-gray-700">Link Dokumen</th>
                                    <th class="px-3 py-2 text-center font-medium text-gray-700">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="vlookup-table-body" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="px-6 py-8 text-center text-gray-400">
                                        <div id="vlookup-loading" class="flex items-center justify-center">
                                            <svg class="animate-spin h-5 w-5 text-gray-400 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                            Memuat data...
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Data Info -->
                    <div class="mt-4 text-sm text-gray-600">
                        <span id="vlookup-info">Menampilkan semua data</span>
                    </div>
                </div>
            </div>
        </div>
    </div>








    <!-- Firebase v8 CDN untuk konsistensi dengan index.html -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <!-- Firebase Config -->
    <script type="module">
        import { firebaseConfig } from './config.js';
        
        // Set config ke window untuk kompatibilitas
        window.firebaseConfig = firebaseConfig;
        
    </script>

    <!-- Simple Header Script -->
    <script>
        function handleLogout() {
            try {
                // Clear session storage
                sessionStorage.removeItem('google_id_token');
                sessionStorage.removeItem('user_info');
                
                // Sign out from Firebase if available
                if (typeof firebase !== 'undefined' && firebase.auth) {
                    firebase.auth().signOut();
                }
                
                // Redirect to login page
                window.location.href = 'index.html';
            } catch (error) {
            }
        }

        window.handleLogout = handleLogout;
    </script>

    <!-- Main Application Script -->
    <script>
        // Global variables
        let database = null;
        let researchRef = null;
        let isFirebaseInitialized = false;
        let isUserAuthenticated = false;
        
        // Initialize Firebase dengan error handling
        function initializeFirebase() {
            try {
                // Check if Firebase is available
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK tidak tersedia. Periksa koneksi internet.');
                }
                
                // Check if config is available
                if (!window.firebaseConfig) {
                    throw new Error('Firebase configuration tidak tersedia. Periksa file config.js.');
                }
                
                // Validate config properties
                const requiredConfigKeys = ['apiKey', 'authDomain', 'databaseURL', 'projectId'];
                const missingKeys = requiredConfigKeys.filter(key => !window.firebaseConfig[key]);
                if (missingKeys.length > 0) {
                    throw new Error(`Konfigurasi Firebase tidak lengkap. Missing: ${missingKeys.join(', ')}`);
                }
                
                // Initialize Firebase
                if (!firebase.apps || firebase.apps.length === 0) {
                    firebase.initializeApp(window.firebaseConfig);
                }
                
                // Get database reference
                database = firebase.database();
                researchRef = database.ref('internal');
                isFirebaseInitialized = true;
                
                
                let connectionRetries = 0;
                const maxRetries = 3;
                
                const monitorConnection = () => {
                    database.ref('.info/connected').on('value', (snapshot) => {
                        const connectionDot = document.getElementById('connection-dot');
                        const connectionText = document.getElementById('connection-text');
                        
                        if (snapshot.val() === true) {
                            connectionRetries = 0; // Reset retry counter
                            
                            // Update UI indicator
                            if (connectionDot && connectionText) {
                                connectionDot.className = 'w-2 h-2 bg-green-400 rounded-full mr-2';
                                connectionText.textContent = 'Connected';
                            }
                        } else {
                            connectionRetries++;
                            
                            // Update UI indicator
                            if (connectionDot && connectionText) {
                                connectionDot.className = 'w-2 h-2 bg-red-400 rounded-full mr-2 animate-pulse';
                                connectionText.textContent = 'Disconnected';
                            }
                            
                            if (connectionRetries >= maxRetries) {
                                showError('Koneksi database tidak stabil. Silakan refresh halaman.');
                                
                                // Update UI indicator
                                if (connectionDot && connectionText) {
                                    connectionDot.className = 'w-2 h-2 bg-red-600 rounded-full mr-2';
                                    connectionText.textContent = 'Connection Failed';
                                }
                            }
                        }
                    });
                };
                
                monitorConnection();
                
                // Set up authentication state listener
                firebase.auth().onAuthStateChanged((user) => {
                    if (user) {
                        isUserAuthenticated = true;
                        loadResearchData();
                    } else {
                        isUserAuthenticated = false;
                        redirectToLogin();
                    }
                });
                
                return true;
            } catch (error) {
                showError('Gagal menginisialisasi Firebase: ' + error.message);
                return false;
            }
        }
        
        // Check user session
        function checkUserSession() {
            try {
                const idToken = sessionStorage.getItem('google_id_token');
                const userInfo = sessionStorage.getItem('user_info');
                
                if (!idToken || !userInfo) {
                    redirectToLogin();
                    return false;
                }
                
                // Check if token is still valid
                const decodedToken = decodeJwt(idToken);
                const currentTime = Math.floor(Date.now() / 1000);
                
                if (decodedToken.exp && decodedToken.exp <= currentTime) {
                    clearSession();
                    redirectToLogin();
                    return false;
                }
                
                return true;
            } catch (error) {
                clearSession();
                redirectToLogin();
                return false;
            }
        }
        
        // Decode JWT token
        function decodeJwt(token) {
            const parts = String(token).split('.');
            if (parts.length < 2) throw new Error('Token tidak valid');
            const base64Url = parts[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const padded = base64 + '='.repeat((4 - (base64.length % 4)) % 4);
            const json = atob(padded);
            return JSON.parse(json);
        }
        
        // Clear session
        function clearSession() {
            try {
                sessionStorage.removeItem('google_id_token');
                sessionStorage.removeItem('user_info');
                if (firebase.auth().currentUser) {
                    firebase.auth().signOut();
                }
            } catch (e) {
                // Error clearing session
            }
        }
        
        // Redirect to login
        function redirectToLogin() {
            window.location.href = 'index.html';
        }
        
        // Show error message
        function showError(message) {
            alert(' Error: ' + message);
        }
        
        // Show loading state
        function showLoading() {
            const loadingSpinner = document.getElementById('loading-spinner');
            const noDataMessage = document.getElementById('no-data-message');
            
            if (loadingSpinner) {
                loadingSpinner.style.display = 'block';
            }
            if (noDataMessage) {
                noDataMessage.style.display = 'none';
            }
        }
        
        // Hide loading state
        function hideLoading() {
            const loadingSpinner = document.getElementById('loading-spinner');
            if (loadingSpinner) {
                loadingSpinner.style.display = 'none';
            }
        }
        
        // Initialize application
        function initializeApp() {
            // Initialize DOM elements
            tableBody = document.getElementById('research-table-body');
            researchModal = document.getElementById('researchModal');
            modalTitle = document.getElementById('modal-title');
            closeResearchModal = document.getElementById('closeResearchModal');
            addResearchBtn = document.getElementById('add-research-btn');
            cancelBtn = document.getElementById('cancel-btn');
            deleteConfirmModal = document.getElementById('deleteConfirmModal');
            confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            researchForm = document.getElementById('research-form');
            submitBtn = document.getElementById('submit-btn');
            
            
            
            if (!tableBody) {
                showError('Table body element tidak ditemukan. Periksa HTML structure.');
                return;
            }
            
            // Check user session first
            if (!checkUserSession()) {
                return;
            }
            
            // Initialize Firebase
            if (!initializeFirebase()) {
                return;
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Set up VLookup event listeners
            setupVlookupEventListeners();
            
            // Set up autocomplete event listeners (but don't load data yet)
            setupAutocompleteEventListeners();
            
            // Set up filter event listeners
            setupFilterEventListeners();
            
            // Initialize autocomplete data after Firebase is ready
            setTimeout(() => {
                initializeAutocompleteData();
            }, 1000);
        }
        
        // Load research data
        function loadResearchData() {
            if (!isFirebaseInitialized || !researchRef) {
                return;
            }
            
            showLoading();
            
            database.ref('.info/connected').once('value').then((snapshot) => {
                // Check if research data exists
                researchRef.once('value').then((dataSnapshot) => {
                    // If no data exists, add sample data
                    if (!dataSnapshot.val()) {
                        const sampleData = {
                            'sample1': {
                                lecturer_name: 'Dr. John Doe, S.T., M.T.',
                                title: 'Pengembangan Sistem Informasi Manajemen',
                                implementation_period: '2024',
                                journal_details: 'Jurnal Teknologi Informasi',
                                journal_link: 'https://example.com/journal',
                                hki_details: '',
                                hki_link: '',
                                media_details: '',
                                media_link: '',
                                notes: 'Penelitian tentang pengembangan sistem informasi untuk manajemen data.',
                                work_folder: 'SIM-2024-001',
                                total_grant: '15000000'
                            },
                            'sample2': {
                                lecturer_name: 'Prof. Jane Smith, S.Kom., M.Kom.',
                                title: 'Implementasi Machine Learning untuk Prediksi',
                                implementation_period: '2024',
                                journal_details: '',
                                journal_link: '',
                                hki_details: 'Hak Kekayaan Intelektual - Algoritma Prediksi',
                                hki_link: 'https://example.com/hki',
                                media_details: '',
                                media_link: '',
                                notes: 'Pengembangan algoritma machine learning untuk prediksi cuaca.',
                                work_folder: 'ML-2024-002',
                                total_grant: '20000000'
                            },
                            'sample3': {
                                lecturer_name: 'Dr. Ahmad Rahman, S.T., M.T.',
                                title: 'Analisis Data Mining untuk Sistem Rekomendasi',
                                implementation_period: '2024',
                                journal_details: '',
                                journal_link: '',
                                hki_details: '',
                                hki_link: '',
                                media_details: 'Kompas Teknologi',
                                media_link: 'https://example.com/kompas',
                                notes: 'Penelitian tentang data mining dengan dataset dan laporan lengkap.',
                                work_folder: 'DM-2024-003',
                                total_grant: '25000000'
                            }
                        };
                        
                        researchRef.set(sampleData).then(() => {
                        }).catch((error) => {
                        });
                    }
                }).catch((error) => {
                });
                
                // Now try to load data with listener
                researchRef.on('value', (snapshot) => {
                    try {
                        const data = snapshot.val();
                        allData = data || {}; // Store data globally
                        
                        // Reset to first page when data changes
                        currentPage = 1;
                        
                        // Render table with pagination
                        renderTableWithPagination(allData);
                        
                        hideLoading();
                    } catch (error) {
                        showError('Gagal memuat data: ' + error.message);
                        hideLoading();
                    }
                }, (error) => {
                    showError('Error koneksi database: ' + error.message);
                    hideLoading();
                });
            }).catch((error) => {
                showError('Gagal menguji koneksi database: ' + error.message);
                hideLoading();
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            
            // Table event delegation
            if (tableBody) {
                tableBody.addEventListener('click', (e) => {
                    const targetButton = e.target.closest('button');
                    if (!targetButton) return;

                    const key = targetButton.dataset.key;
                    if (targetButton.classList.contains('view-btn')) {
                        toggleCollapse(key);
                    } else if (targetButton.classList.contains('edit-btn') || targetButton.classList.contains('edit-inline-btn')) {
                        showResearchModal('edit', key, allData[key]);
                    } else if (targetButton.classList.contains('delete-btn')) {
                        showDeleteConfirmModal(key);
                    } else if (targetButton.classList.contains('close-collapse-btn')) {
                        hideCollapse(key);
                    }
                });
            }
            
            // Modal event listeners
            if (addResearchBtn) {
                addResearchBtn.addEventListener('click', () => {
                    showResearchModal('add');
                });
            } else {
            }
            
            if (closeResearchModal) closeResearchModal.addEventListener('click', hideResearchModal);
            if (cancelBtn) cancelBtn.addEventListener('click', hideResearchModal);
            
            // Close modal when clicking outside
            if (researchModal) {
                researchModal.addEventListener('click', (e) => {
                    if (e.target === researchModal) {
                        hideResearchModal();
                    }
                });
            }
            
            
            // Pagination Event Listeners
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            const itemsPerPageSelect = document.getElementById('items-per-page');
            
            if (prevPageBtn) prevPageBtn.addEventListener('click', goToPreviousPage);
            if (nextPageBtn) nextPageBtn.addEventListener('click', goToNextPage);
            if (itemsPerPageSelect) {
                itemsPerPageSelect.addEventListener('change', (e) => {
                    changeItemsPerPage(e.target.value);
                });
            }
            
            // Form submission event listener
            if (researchForm) {
                researchForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const formData = new FormData(researchForm);
                    const key = formData.get('edit-key');
                    
                    // Get journal title from dataset if available
                    const journalLinkField = document.getElementById('journal_link');
                    const journalTitle = journalLinkField ? journalLinkField.dataset.journalTitle || '' : '';
                    
                    const researchData = {
                        lecturer_name: formData.get('lecturer_name'),
                        title: formData.get('title'),
                        implementation_period: formData.get('implementation_period'),
                        journal_details: formData.get('journal_details') || '',
                        journal_link: formData.get('journal_link') || '',
                        journal_title: journalTitle,
                        hki_details: formData.get('hki_details') || '',
                        hki_link: formData.get('hki_link') || '',
                        media_details: formData.get('media_details') || '',
                        media_link: formData.get('media_link') || '',
                        notes: formData.get('notes') || '',
                        work_folder: formData.get('work_folder') || '',
                        total_grant: getNumericValue(formData.get('total_grant')) || ''
                    };

                    if (key) { // Update existing data
                        const itemRef = database.ref('internal/' + key);
                        
                        itemRef.update(researchData)
                            .then(() => {
                                showToast('Penelitian berhasil diperbarui!', 'success');
                                hideResearchModal();
                            })
                            .catch((error) => {
                                showToast('Error memperbarui penelitian: ' + error.message, 'error');
                            });
                    } else { // Add new data
                        const newResearchRef = database.ref('internal').push();
                        
                        newResearchRef.set(researchData)
                            .then(() => {
                                showToast('Penelitian berhasil ditambahkan!', 'success');
                                hideResearchModal();
                            })
                            .catch((error) => {
                                showToast('Error menambahkan penelitian: ' + error.message, 'error');
                            });
                    }
                });
            }
            
            // Delete confirmation event listener
            if (confirmDeleteBtn) {
                confirmDeleteBtn.addEventListener('click', () => {
                    if (keyToDelete) {
                        const itemRef = database.ref('internal/' + keyToDelete);
                        
                        itemRef.remove()
                            .then(() => {
                                showToast('Penelitian berhasil dihapus!', 'success');
                            })
                            .catch((error) => {
                                showToast('Error menghapus penelitian: ' + error.message, 'error');
                            })
                            .finally(() => {
                                hideDeleteConfirmModal();
                            });
                    }
                });
            }
            
            // Cancel delete event listener
            if (cancelDeleteBtn) {
                cancelDeleteBtn.addEventListener('click', hideDeleteConfirmModal);
            }
            
        }
        
        // Function to populate year dropdown
        function populateYearDropdown() {
            const yearSelect = document.getElementById('implementation_period');
            if (!yearSelect) return;
            
            const currentYear = new Date().getFullYear();
            const years = [];
            
            // Generate 3 years back and 3 years forward
            for (let i = currentYear - 3; i <= currentYear + 3; i++) {
                years.push(i);
            }
            
            // Clear existing options except the first one
            yearSelect.innerHTML = '<option value="">Pilih Tahun</option>';
            
            // Add year options
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            });
        }
        
        // Setup collapse form listeners for autocomplete
        function setupCollapseFormListeners(key) {
            const journalInput = document.getElementById(`journal_link-${key}`);
            if (!journalInput) return;
            
            // Setup autocomplete for this collapse form
            journalInput.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                
                if (autocompleteTimeout) {
                    clearTimeout(autocompleteTimeout);
                }
                
                if (query.length < 2) {
                    hideCollapseAutocomplete(key);
                    return;
                }
                
                autocompleteTimeout = setTimeout(() => {
                    searchCollapseAutocomplete(query, key);
                }, 150);
            });
            
            // Focus event
            journalInput.addEventListener('focus', (e) => {
                const query = e.target.value.trim();
                if (query.length >= 2) {
                    searchCollapseAutocomplete(query, key);
                }
            });
            
            // Click outside to hide
            document.addEventListener('click', (e) => {
                const autocompleteDropdown = document.getElementById(`journal-autocomplete-${key}`);
                if (autocompleteDropdown && !journalInput.contains(e.target) && !autocompleteDropdown.contains(e.target)) {
                    hideCollapseAutocomplete(key);
                }
            });
        }
        
        // Handle collapse form submission
        function handleCollapseFormSubmit(key, form) {
            if (!database) {
                showError('Database tidak tersedia');
                return;
            }
            
            const formData = new FormData(form);
            const journalLinkField = document.getElementById(`journal_link-${key}`);
            const journalTitle = journalLinkField ? journalLinkField.dataset.journalTitle || '' : '';
            
            // Hanya update field yang ada di form collapse
            const researchData = {
                journal_details: formData.get('journal_details') || '',
                journal_link: formData.get('journal_link') || '',
                journal_title: journalTitle,
                hki_details: formData.get('hki_details') || '',
                hki_link: formData.get('hki_link') || '',
                media_details: formData.get('media_details') || '',
                media_link: formData.get('media_link') || '',
                notes: formData.get('notes') || '',
                work_folder: formData.get('work_folder') || '',
                total_grant: getNumericValue(formData.get('total_grant')) || ''
            };
            
            const itemRef = database.ref('internal/' + key);
            
            itemRef.update(researchData)
                .then(() => {
                    showToast('Penelitian berhasil diperbarui!', 'success');
                    hideCollapse(key);
                })
                .catch((error) => {
                    showToast('Error memperbarui penelitian: ' + error.message, 'error');
                });
        }
        
        // Search autocomplete for collapse forms
        function searchCollapseAutocomplete(query, key) {
            if (!autocompleteData || Object.keys(autocompleteData).length === 0) {
                return;
            }
            
            showCollapseAutocompleteLoading(key);
            
            setTimeout(() => {
                const results = [];
                const queryLower = query.toLowerCase().trim();
                
                Object.entries(autocompleteData).forEach(([dataKey, value]) => {
                    if (!value) return;
                    
                    const titleLower = (value.title || '').toLowerCase();
                    const journalLink = value.doc_link || 
                                      value.journal_link || 
                                      value.journalLink || 
                                      value.link || 
                                      value.url || 
                                      value.journal_url ||
                                      value.paper_link ||
                                      value.doi ||
                                      value.article_link || '';
                    
                    let isMatch = false;
                    let matchScore = 0;
                    
                    if (titleLower === queryLower) {
                        isMatch = true;
                        matchScore = 100;
                    } else if (titleLower.startsWith(queryLower)) {
                        isMatch = true;
                        matchScore = 90;
                    } else if (titleLower.includes(queryLower)) {
                        isMatch = true;
                        matchScore = 80;
                    }
                    
                    if (isMatch) {
                        results.push({
                            key: dataKey,
                            title: value.title || '',
                            status: value.status || '',
                            year: value.implementation_year || value.implementation_period || '',
                            journal_link: journalLink,
                            source: value.research_id ? 'research' : 'pustakana',
                            matchScore: matchScore
                        });
                    }
                });
                
                results.sort((a, b) => {
                    if (a.matchScore !== b.matchScore) {
                        return b.matchScore - a.matchScore;
                    }
                    return a.title.length - b.title.length;
                });
                
                const limitedResults = results.slice(0, 10);
                renderCollapseAutocompleteResults(limitedResults, key);
            }, 100);
        }
        
        // Show collapse autocomplete loading
        function showCollapseAutocompleteLoading(key) {
            const loading = document.getElementById(`journal-autocomplete-loading-${key}`);
            const results = document.getElementById(`journal-autocomplete-results-${key}`);
            const noResults = document.getElementById(`journal-autocomplete-no-results-${key}`);
            const dropdown = document.getElementById(`journal-autocomplete-${key}`);
            
            if (loading) loading.classList.remove('hidden');
            if (results) results.classList.add('hidden');
            if (noResults) noResults.classList.add('hidden');
            if (dropdown) dropdown.classList.remove('hidden');
        }
        
        // Render collapse autocomplete results
        function renderCollapseAutocompleteResults(results, key) {
            const loading = document.getElementById(`journal-autocomplete-loading-${key}`);
            const resultsContainer = document.getElementById(`journal-autocomplete-results-${key}`);
            const noResults = document.getElementById(`journal-autocomplete-no-results-${key}`);
            const dropdown = document.getElementById(`journal-autocomplete-${key}`);
            
            if (loading) loading.classList.add('hidden');
            
            if (results.length === 0) {
                if (resultsContainer) resultsContainer.classList.add('hidden');
                if (noResults) noResults.classList.add('hidden');
            } else {
                if (noResults) noResults.classList.add('hidden');
                if (resultsContainer) {
                    resultsContainer.innerHTML = '';
                    resultsContainer.classList.remove('hidden');
                    
                    results.forEach((item, index) => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'autocomplete-item px-3 py-2 text-sm cursor-pointer hover:bg-gray-100 border-b border-gray-100 last:border-b-0';
                        itemElement.dataset.key = item.key;
                        itemElement.dataset.source = item.source;
                        
                        if (index === 0) {
                            itemElement.classList.add('active');
                        }
                        
                        itemElement.innerHTML = `
                            <div class="font-medium text-gray-900 truncate text-xs" title="${item.title}">
                                ${item.title}
                            </div>
                        `;
                        
                        itemElement.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            selectCollapseAutocompleteItem(itemElement, key);
                        });
                        
                        resultsContainer.appendChild(itemElement);
                    });
                }
            }
            
            if (dropdown) {
                if (results.length > 0) {
                    dropdown.classList.remove('hidden');
                } else {
                    dropdown.classList.add('hidden');
                }
            }
        }
        
        // Select collapse autocomplete item
        function selectCollapseAutocompleteItem(itemElement, collapseKey) {
            const dataKey = itemElement.dataset.key;
            const selectedData = autocompleteData[dataKey];
            
            if (!selectedData) {
                return;
            }
            
            const journalLinkField = document.getElementById(`journal_link-${collapseKey}`);
            if (journalLinkField) {
                const journalLink = selectedData.doc_link || 
                                  selectedData.journal_link || 
                                  selectedData.journalLink || 
                                  selectedData.link || 
                                  selectedData.url || 
                                  selectedData.journal_url ||
                                  selectedData.paper_link ||
                                  selectedData.doi ||
                                  selectedData.article_link;
                
                if (journalLink) {
                    journalLinkField.value = journalLink;
                    journalLinkField.dataset.journalTitle = selectedData.title || '';
                    journalLinkField.dispatchEvent(new Event('input', { bubbles: true }));
                }
            }
            
            hideCollapseAutocomplete(collapseKey);
        }
        
        // Hide collapse autocomplete
        function hideCollapseAutocomplete(key) {
            const dropdown = document.getElementById(`journal-autocomplete-${key}`);
            if (dropdown) {
                dropdown.classList.add('hidden');
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            populateYearDropdown();
        });

        // ===== VLOOKUP FUNCTIONALITY =====
        
        // VLookup variables
        let vlookupData = {};
        let vlookupCurrentPage = 1;
        let vlookupItemsPerPage = 10;
        let vlookupFilteredData = [];
        let vlookupCurrentSource = 'pustakana'; // 'pustakana' or 'research'
        
        // Initialize VLookup DOM elements
        function initializeVlookupElements() {
            // VLookup button removed
        }
        
        // Setup VLookup event listeners
        function setupVlookupEventListeners() {
            // VLookup button event listener removed
            
            // Modal event listeners
            const closeVlookupModal = document.getElementById('closeVlookupModal');
            const vlookupModal = document.getElementById('vlookupModal');
            
            if (closeVlookupModal) {
                closeVlookupModal.addEventListener('click', hideVlookupModal);
            }
            
            if (vlookupModal) {
                vlookupModal.addEventListener('click', (e) => {
                    if (e.target === vlookupModal) {
                        hideVlookupModal();
                    }
                });
            }
            
            // Database source radio buttons
            const databaseRadios = document.querySelectorAll('input[name="database-source"]');
            databaseRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    vlookupCurrentSource = e.target.value;
                    loadVlookupData();
                });
            });
            
            // Search and filter event listeners
            const vlookupSearch = document.getElementById('vlookup-search');
            const vlookupStatusFilter = document.getElementById('vlookup-status-filter');
            
            if (vlookupSearch) {
                vlookupSearch.addEventListener('input', applyVlookupFilters);
            }
            
            if (vlookupStatusFilter) {
                vlookupStatusFilter.addEventListener('change', applyVlookupFilters);
            }
            
            // Pagination event listeners
            const vlookupPrevBtn = document.getElementById('vlookup-prev');
            const vlookupNextBtn = document.getElementById('vlookup-next');
            
            if (vlookupPrevBtn) {
                vlookupPrevBtn.addEventListener('click', goToVlookupPreviousPage);
            }
            
            if (vlookupNextBtn) {
                vlookupNextBtn.addEventListener('click', goToVlookupNextPage);
            }
        }
        
        // Open VLookup modal
        function openVlookupModal() {
            const vlookupModal = document.getElementById('vlookupModal');
            if (vlookupModal) {
                vlookupModal.classList.remove('hidden');
                loadVlookupData();
            }
        }
        
        // Hide VLookup modal
        function hideVlookupModal() {
            const vlookupModal = document.getElementById('vlookupModal');
            if (vlookupModal) {
                vlookupModal.classList.add('hidden');
            }
            
            // Reset search and filter
            const vlookupSearch = document.getElementById('vlookup-search');
            const vlookupStatusFilter = document.getElementById('vlookup-status-filter');
            
            if (vlookupSearch) vlookupSearch.value = '';
            if (vlookupStatusFilter) vlookupStatusFilter.value = '';
            
            vlookupCurrentPage = 1;
        }
        
        // Load data from Firebase
        function loadVlookupData() {
            if (!database) {
                showError('Database tidak tersedia');
                return;
            }
            
            const vlookupTableBody = document.getElementById('vlookup-table-body');
            
            // Show loading
            if (vlookupTableBody) {
                vlookupTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-gray-400">
                            <div class="flex items-center justify-center">
                                <svg class="animate-spin h-5 w-5 text-gray-400 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                Memuat data dari ${vlookupCurrentSource}...
                            </div>
                        </td>
                    </tr>
                `;
            }
            
            // Fetch data from selected collection
            const collectionRef = database.ref(vlookupCurrentSource);
            
            collectionRef.once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    vlookupData = data || {};
                    
                    // Apply filters
                    applyVlookupFilters();
                })
                .catch((error) => {
                    showError('Gagal memuat data dari ' + vlookupCurrentSource + ': ' + error.message);
                    
                    if (vlookupTableBody) {
                        vlookupTableBody.innerHTML = `
                            <tr>
                                <td colspan="7" class="px-6 py-8 text-center text-red-400">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    Gagal memuat data
                                </td>
                            </tr>
                        `;
                    }
                });
        }
        
        // Apply filters to vlookup data
        function applyVlookupFilters() {
            if (!vlookupData || Object.keys(vlookupData).length === 0) {
                renderVlookupTable({});
                return;
            }
            
            const vlookupSearch = document.getElementById('vlookup-search');
            const vlookupStatusFilter = document.getElementById('vlookup-status-filter');
            
            const searchTerm = vlookupSearch ? vlookupSearch.value.toLowerCase().trim() : '';
            const statusFilter = vlookupStatusFilter ? vlookupStatusFilter.value : '';
            
            // Filter data
            let filteredData = {};
            
            Object.entries(vlookupData).forEach(([key, value]) => {
                if (!value) return;
                
                let matches = true;
                
                // Search filter - berdasarkan judul penelitian
                if (searchTerm && !value.title?.toLowerCase().includes(searchTerm)) {
                    matches = false;
                }
                
                // Status filter
                if (statusFilter && value.status !== statusFilter) {
                    matches = false;
                }
                
                if (matches) {
                    filteredData[key] = value;
                }
            });
            
            vlookupFilteredData = Object.entries(filteredData);
            vlookupCurrentPage = 1;
            
            renderVlookupTable(filteredData);
        }
        
        // Render vlookup table with pagination
        function renderVlookupTable(data) {
            const vlookupTableBody = document.getElementById('vlookup-table-body');
            if (!vlookupTableBody) return;
            
            const totalItems = vlookupFilteredData.length;
            const totalPages = Math.ceil(totalItems / vlookupItemsPerPage);
            
            // Ensure current page is valid
            if (vlookupCurrentPage > totalPages) {
                vlookupCurrentPage = totalPages;
            }
            if (vlookupCurrentPage < 1) {
                vlookupCurrentPage = 1;
            }
            
            // Get current page data
            const startIndex = (vlookupCurrentPage - 1) * vlookupItemsPerPage;
            const endIndex = startIndex + vlookupItemsPerPage;
            const currentPageData = vlookupFilteredData.slice(startIndex, endIndex);
            
            // Clear table
            vlookupTableBody.innerHTML = '';
            
            if (currentPageData.length === 0) {
                vlookupTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-gray-400">
                            <i class="fas fa-search mr-2"></i>
                            Tidak ada data yang sesuai dengan filter
                        </td>
                    </tr>
                `;
            } else {
                // Render current page data
                currentPageData.forEach(([key, value]) => {
                    const row = document.createElement('tr');
                    row.classList.add('hover:bg-gray-50');
                    
                    row.innerHTML = `
                        <td class="px-3 py-2 text-xs text-gray-600">${value.research_id || key}</td>
                        <td class="px-3 py-2 text-xs text-gray-800" title="${value.title || ''}">
                            <div class="max-w-xs truncate">${value.title || ''}</div>
                        </td>
                        <td class="px-3 py-2 text-xs">
                            <span class="px-2 py-1 rounded-full text-xs ${getStatusBadgeClass(value.status)}">
                                ${value.status || ''}
                            </span>
                        </td>
                        <td class="px-3 py-2 text-xs text-gray-600">${value.implementation_year || value.implementation_period || ''}</td>
                        <td class="px-3 py-2 text-xs">
                            ${value.journal_link ? 
                                `<a href="${value.journal_link}" target="_blank" class="text-blue-600 hover:underline">
                                    <i class="fas fa-external-link-alt"></i>
                                </a>` : 
                                '<span class="text-gray-400">-</span>'
                            }
                        </td>
                        <td class="px-3 py-2 text-xs">
                            ${value.doc_link ? 
                                `<a href="${value.doc_link}" target="_blank" class="text-blue-600 hover:underline">
                                    <i class="fas fa-external-link-alt"></i>
                                </a>` : 
                                '<span class="text-gray-400">-</span>'
                            }
                        </td>
                        <td class="px-3 py-2 text-center">
                            <button onclick="selectVlookupData('${key}')" 
                                    class="px-3 py-1 bg-indigo-600 text-white text-xs rounded hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <i class="fas fa-check mr-1"></i>
                                Pilih
                            </button>
                        </td>
                    `;
                    
                    vlookupTableBody.appendChild(row);
                });
            }
            
            // Update pagination info
            updateVlookupPaginationInfo(startIndex + 1, Math.min(endIndex, totalItems), totalItems);
            updateVlookupNavigationButtons(totalPages);
        }
        
        // Update vlookup pagination info
        function updateVlookupPaginationInfo(start, end, total) {
            const vlookupInfo = document.getElementById('vlookup-info');
            const vlookupPageInfo = document.getElementById('vlookup-page-info');
            
            if (vlookupInfo) {
                if (total === 0) {
                    vlookupInfo.textContent = 'Tidak ada data';
                } else {
                    vlookupInfo.textContent = `Menampilkan ${start}-${end} dari ${total} data`;
                }
            }
            
            if (vlookupPageInfo) {
                const totalPages = Math.ceil(total / vlookupItemsPerPage);
                vlookupPageInfo.textContent = `${vlookupCurrentPage} / ${totalPages}`;
            }
        }
        
        // Update vlookup navigation buttons
        function updateVlookupNavigationButtons(totalPages) {
            const vlookupPrevBtn = document.getElementById('vlookup-prev');
            const vlookupNextBtn = document.getElementById('vlookup-next');
            
            if (vlookupPrevBtn) {
                vlookupPrevBtn.disabled = vlookupCurrentPage <= 1;
            }
            
            if (vlookupNextBtn) {
                vlookupNextBtn.disabled = vlookupCurrentPage >= totalPages;
            }
        }
        
        // Go to previous page
        function goToVlookupPreviousPage() {
            if (vlookupCurrentPage > 1) {
                vlookupCurrentPage--;
                renderVlookupTable(vlookupData);
            }
        }
        
        // Go to next page
        function goToVlookupNextPage() {
            const totalPages = Math.ceil(vlookupFilteredData.length / vlookupItemsPerPage);
            if (vlookupCurrentPage < totalPages) {
                vlookupCurrentPage++;
                renderVlookupTable(vlookupData);
            }
        }
        
        // Select vlookup data and fill form
        function selectVlookupData(key) {
            
            const selectedData = vlookupData[key];
            if (!selectedData) {
                return;
            }
            
            
            // Fill journal link (REPLACE the current value)
            const journalLinkField = document.getElementById('journal_link');
            if (journalLinkField) {
                // Try different possible field names for journal link
                const journalLink = selectedData.doc_link || 
                                  selectedData.journal_link || 
                                  selectedData.journalLink || 
                                  selectedData.link || 
                                  selectedData.url || 
                                  selectedData.journal_url ||
                                  selectedData.paper_link ||
                                  selectedData.doi ||
                                  selectedData.article_link;
                
                if (journalLink) {
                    journalLinkField.value = journalLink;
                    
                    // Trigger input event to show the change
                    journalLinkField.dispatchEvent(new Event('input', { bubbles: true }));
                } else {
                    
                    // Show user-friendly message
                    showToast('Data dipilih tetapi tidak memiliki link jurnal', 'warning');
                }
            } else {
            }
            
            
            // Close modal
            hideVlookupModal();
            
        }
        
        window.selectVlookupData = selectVlookupData;
        
        // Get status badge class
        function getStatusBadgeClass(status) {
            const classes = {
                'Draft': 'bg-gray-100 text-gray-800',
                'Writing': 'bg-blue-100 text-blue-800',
                'Submit': 'bg-yellow-100 text-yellow-800',
                'Review': 'bg-orange-100 text-orange-800',
                'Declined': 'bg-red-100 text-red-800',
                'Accepted': 'bg-green-100 text-green-800',
                'Published': 'bg-green-100 text-green-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }

        // ===== AUTOCOMPLETE FUNCTIONALITY =====

        // Initialize autocomplete data from both databases
        function initializeAutocompleteData() {
            
            if (!database) {
                // Use test data instead
                autocompleteData = {
                    'pustakana_001': {
                        title: 'Implementasi Machine Learning untuk Prediksi Harga Saham',
                        status: 'Published',
                        implementation_year: '2023',
                        journal_link: 'https://ieeexplore.ieee.org/document/9876543',
                        research_id: 'PUST-2023-001',
                        lecturer_name: 'Dr. Ahmad Wijaya, S.T., M.T.',
                        doc_link: 'https://drive.google.com/file/d/1abc123def456ghi789'
                    },
                    'pustakana_002': {
                        title: 'Analisis Sentimen Media Sosial Menggunakan Deep Learning',
                        status: 'Accepted',
                        implementation_year: '2023',
                        journal_link: 'https://www.sciencedirect.com/science/article/pii/S1234567890123456',
                        research_id: 'PUST-2023-002',
                        lecturer_name: 'Dr. Siti Nurhaliza, S.Kom., M.Kom.',
                        doc_link: 'https://drive.google.com/file/d/2def456ghi789jkl012'
                    },
                    'research_001': {
                        title: 'Sistem Rekomendasi E-Commerce Berbasis Collaborative Filtering',
                        status: 'Review',
                        implementation_year: '2024',
                        journal_link: 'https://link.springer.com/article/10.1007/s12345-024-01234-5',
                        research_id: 'RES-2024-001',
                        lecturer_name: 'Prof. Dr. Budi Santoso, S.T., M.T., Ph.D.',
                        doc_link: 'https://drive.google.com/file/d/3ghi789jkl012mno345'
                    },
                    'research_002': {
                        title: 'Optimasi Algoritma Genetika untuk Penjadwalan Produksi',
                        status: 'Published',
                        implementation_year: '2023',
                        journal_link: 'https://www.mdpi.com/2076-3417/13/8/4567',
                        research_id: 'RES-2023-001',
                        lecturer_name: 'Dr. Maria Magdalena, S.T., M.Eng.',
                        doc_link: 'https://drive.google.com/file/d/4jkl012mno345pqr678'
                    },
                    'pustakana_003': {
                        title: 'Blockchain untuk Keamanan Data Medis',
                        status: 'Submit',
                        implementation_year: '2024',
                        journal_link: 'https://www.nature.com/articles/s41598-024-12345-6',
                        research_id: 'PUST-2024-001',
                        lecturer_name: 'Dr. Rizki Pratama, S.T., M.Sc.',
                        doc_link: 'https://drive.google.com/file/d/5mno345pqr678stu901'
                    },
                    'research_003': {
                        title: 'Internet of Things untuk Smart Agriculture',
                        status: 'Writing',
                        implementation_year: '2024',
                        journal_link: 'https://www.frontiersin.org/articles/10.3389/frobt.2024.1234567',
                        research_id: 'RES-2024-002',
                        lecturer_name: 'Dr. Agus Setiawan, S.T., M.T.',
                        doc_link: 'https://drive.google.com/file/d/6pqr678stu901vwx234'
                    },
                    'pustakana_004': {
                        title: 'Computer Vision untuk Deteksi Penyakit Tanaman',
                        status: 'Draft',
                        implementation_year: '2024',
                        journal_link: 'https://www.sciencedirect.com/science/article/pii/S0987654321098765',
                        research_id: 'PUST-2024-002',
                        lecturer_name: 'Dr. Indah Sari, S.T., M.Kom.',
                        doc_link: 'https://drive.google.com/file/d/7stu901vwx234yza567'
                    }
                };
                return;
            }


            // Load data from both collections
            const pustakanaRef = database.ref('pustakana');
            const researchRef = database.ref('research');

            Promise.all([
                pustakanaRef.once('value'),
                researchRef.once('value')
            ]).then(([pustakanaSnapshot, researchSnapshot]) => {
                const pustakanaData = pustakanaSnapshot.val() || {};
                const researchData = researchSnapshot.val() || {};


                // Combine data from both sources
                autocompleteData = {
                    ...pustakanaData,
                    ...researchData
                };

                
                
                // Add some test data if no data is available
                if (Object.keys(autocompleteData).length === 0) {
                    autocompleteData = {
                        'test1': {
                            title: 'Penelitian tentang Machine Learning',
                            status: 'Published',
                            implementation_year: '2023',
                            journal_link: 'https://example.com/journal1'
                        },
                        'test2': {
                            title: 'Analisis Data Mining untuk Big Data',
                            status: 'Accepted',
                            implementation_year: '2023',
                            journal_link: 'https://example.com/journal2'
                        },
                        'test3': {
                            title: 'Implementasi Deep Learning',
                            status: 'Review',
                            implementation_year: '2024',
                            journal_link: 'https://example.com/journal3'
                        }
                    };
                }
            }).catch((error) => {
                // Use test data as fallback
                autocompleteData = {
                    'pustakana_001': {
                        title: 'Implementasi Machine Learning untuk Prediksi Harga Saham',
                        status: 'Published',
                        implementation_year: '2023',
                        journal_link: 'https://ieeexplore.ieee.org/document/9876543',
                        research_id: 'PUST-2023-001',
                        lecturer_name: 'Dr. Ahmad Wijaya, S.T., M.T.',
                        doc_link: 'https://drive.google.com/file/d/1abc123def456ghi789'
                    },
                    'pustakana_002': {
                        title: 'Analisis Sentimen Media Sosial Menggunakan Deep Learning',
                        status: 'Accepted',
                        implementation_year: '2023',
                        journal_link: 'https://www.sciencedirect.com/science/article/pii/S1234567890123456',
                        research_id: 'PUST-2023-002',
                        lecturer_name: 'Dr. Siti Nurhaliza, S.Kom., M.Kom.',
                        doc_link: 'https://drive.google.com/file/d/2def456ghi789jkl012'
                    },
                    'research_001': {
                        title: 'Sistem Rekomendasi E-Commerce Berbasis Collaborative Filtering',
                        status: 'Review',
                        implementation_year: '2024',
                        journal_link: 'https://link.springer.com/article/10.1007/s12345-024-01234-5',
                        research_id: 'RES-2024-001',
                        lecturer_name: 'Prof. Dr. Budi Santoso, S.T., M.T., Ph.D.',
                        doc_link: 'https://drive.google.com/file/d/3ghi789jkl012mno345'
                    },
                    'research_002': {
                        title: 'Optimasi Algoritma Genetika untuk Penjadwalan Produksi',
                        status: 'Published',
                        implementation_year: '2023',
                        journal_link: 'https://www.mdpi.com/2076-3417/13/8/4567',
                        research_id: 'RES-2023-001',
                        lecturer_name: 'Dr. Maria Magdalena, S.T., M.Eng.',
                        doc_link: 'https://drive.google.com/file/d/4jkl012mno345pqr678'
                    },
                    'pustakana_003': {
                        title: 'Blockchain untuk Keamanan Data Medis',
                        status: 'Submit',
                        implementation_year: '2024',
                        journal_link: 'https://www.nature.com/articles/s41598-024-12345-6',
                        research_id: 'PUST-2024-001',
                        lecturer_name: 'Dr. Rizki Pratama, S.T., M.Sc.',
                        doc_link: 'https://drive.google.com/file/d/5mno345pqr678stu901'
                    },
                    'research_003': {
                        title: 'Internet of Things untuk Smart Agriculture',
                        status: 'Writing',
                        implementation_year: '2024',
                        journal_link: 'https://www.frontiersin.org/articles/10.3389/frobt.2024.1234567',
                        research_id: 'RES-2024-002',
                        lecturer_name: 'Dr. Agus Setiawan, S.T., M.T.',
                        doc_link: 'https://drive.google.com/file/d/6pqr678stu901vwx234'
                    },
                    'pustakana_004': {
                        title: 'Computer Vision untuk Deteksi Penyakit Tanaman',
                        status: 'Draft',
                        implementation_year: '2024',
                        journal_link: 'https://www.sciencedirect.com/science/article/pii/S0987654321098765',
                        research_id: 'PUST-2024-002',
                        lecturer_name: 'Dr. Indah Sari, S.T., M.Kom.',
                        doc_link: 'https://drive.google.com/file/d/7stu901vwx234yza567'
                    }
                };
            });
        }

        // Setup autocomplete event listeners
        function setupAutocompleteEventListeners() {
            
            const journalInput = document.getElementById('journal_link');
            const autocompleteDropdown = document.getElementById('journal-autocomplete');


            if (!journalInput || !autocompleteDropdown) {
                return;
            }


            // Input event listener with debouncing
            journalInput.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                
                // Clear previous timeout
                if (autocompleteTimeout) {
                    clearTimeout(autocompleteTimeout);
                }

                // Hide dropdown if query is too short
                if (query.length < 2) {
                    hideAutocomplete();
                    return;
                }

                // Optimized debounce search - shorter delay for better UX
                autocompleteTimeout = setTimeout(() => {
                    searchAutocomplete(query);
                }, 150);
            });

            // Focus event listener
            journalInput.addEventListener('focus', (e) => {
                const query = e.target.value.trim();
                if (query.length >= 2) {
                    searchAutocomplete(query);
                }
            });

            // Click outside to hide dropdown
            document.addEventListener('click', (e) => {
                if (!journalInput.contains(e.target) && !autocompleteDropdown.contains(e.target)) {
                    hideAutocomplete();
                }
            });

            // Keyboard navigation
            journalInput.addEventListener('keydown', (e) => {
                const dropdown = document.getElementById('journal-autocomplete');
                const results = dropdown.querySelectorAll('.autocomplete-item');
                const activeItem = dropdown.querySelector('.autocomplete-item.active');

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (activeItem) {
                        activeItem.classList.remove('active');
                        const nextItem = activeItem.nextElementSibling;
                        if (nextItem) {
                            nextItem.classList.add('active');
                        } else {
                            results[0]?.classList.add('active');
                        }
                    } else {
                        results[0]?.classList.add('active');
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (activeItem) {
                        activeItem.classList.remove('active');
                        const prevItem = activeItem.previousElementSibling;
                        if (prevItem) {
                            prevItem.classList.add('active');
                        } else {
                            results[results.length - 1]?.classList.add('active');
                        }
                    } else {
                        results[results.length - 1]?.classList.add('active');
                    }
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (activeItem) {
                        selectAutocompleteItem(activeItem);
                    }
                } else if (e.key === 'Escape') {
                    hideAutocomplete();
                }
            });
        }

        // Search autocomplete
        function searchAutocomplete(query) {
            
            if (!autocompleteData || Object.keys(autocompleteData).length === 0) {
                return;
            }

            showAutocompleteLoading();

            // Simulate async search (in real app, this could be server-side)
            setTimeout(() => {
                const results = [];
                const queryLower = query.toLowerCase().trim();


                // Search through all data with optimized logic
                Object.entries(autocompleteData).forEach(([key, value]) => {
                    if (!value) return;

                    const titleLower = (value.title || '').toLowerCase();
                    
                    // Try different possible field names for journal link
                    const journalLink = value.doc_link || 
                                      value.journal_link || 
                                      value.journalLink || 
                                      value.link || 
                                      value.url || 
                                      value.journal_url ||
                                      value.paper_link ||
                                      value.doi ||
                                      value.article_link || '';
                    const journalLinkLower = journalLink.toLowerCase();
                    
                    // Title-only search logic
                    let isMatch = false;
                    let matchType = '';
                    let matchScore = 0;
                    
                    // Check for exact title match (highest priority)
                    if (titleLower === queryLower) {
                        isMatch = true;
                        matchType = 'exact_title';
                        matchScore = 100;
                    }
                    // Check for title starts with match
                    else if (titleLower.startsWith(queryLower)) {
                        isMatch = true;
                        matchType = 'title_starts_with';
                        matchScore = 90;
                    }
                    // Check for title contains match
                    else if (titleLower.includes(queryLower)) {
                        isMatch = true;
                        matchType = 'title_contains';
                        matchScore = 80;
                    }
                    // Check for word boundary matches in title
                    else if (queryLower.length >= 2) {
                        const titleWords = titleLower.split(/\s+/);
                        const queryWords = queryLower.split(/\s+/);
                        const matchingWords = queryWords.filter(qWord => 
                            titleWords.some(tWord => tWord.includes(qWord))
                        );
                        if (matchingWords.length > 0) {
                            isMatch = true;
                            matchType = 'word_match';
                            matchScore = 70 + (matchingWords.length * 5);
                        }
                    }
                    // Check for character sequence matches (for very short queries)
                    else if (queryLower.length >= 1) {
                        const titleChars = titleLower.replace(/\s+/g, '');
                        if (titleChars.includes(queryLower)) {
                            isMatch = true;
                            matchType = 'char_sequence';
                            matchScore = 60;
                        }
                    }
                    
                    if (isMatch) {
                        results.push({
                            key: key,
                            title: value.title || '',
                            status: value.status || '',
                            year: value.implementation_year || value.implementation_period || '',
                            journal_link: journalLink,
                            source: value.research_id ? 'research' : 'pustakana',
                            matchType: matchType,
                            matchScore: matchScore
                        });
                    }
                });


                // Sort by relevance using matchScore (higher score = better match)
                results.sort((a, b) => {
                    // Primary sort: by match score (descending)
                    if (a.matchScore !== b.matchScore) {
                        return b.matchScore - a.matchScore;
                    }
                    
                    // Secondary sort: by title length (shorter first for better readability)
                    if (a.title.length !== b.title.length) {
                        return a.title.length - b.title.length;
                    }
                    
                    // Tertiary sort: alphabetically by title
                    return a.title.localeCompare(b.title);
                });

                // Limit to 10 results
                const limitedResults = results.slice(0, 10);
                
                renderAutocompleteResults(limitedResults);
            }, 100);
        }

        // Show autocomplete loading
        function showAutocompleteLoading() {
            const loading = document.getElementById('journal-autocomplete-loading');
            const results = document.getElementById('journal-autocomplete-results');
            const noResults = document.getElementById('journal-autocomplete-no-results');
            const dropdown = document.getElementById('journal-autocomplete');

            if (loading) loading.classList.remove('hidden');
            if (results) results.classList.add('hidden');
            if (noResults) noResults.classList.add('hidden');
            if (dropdown) dropdown.classList.remove('hidden');
        }

        // Render autocomplete results
        function renderAutocompleteResults(results) {
            
            const loading = document.getElementById('journal-autocomplete-loading');
            const resultsContainer = document.getElementById('journal-autocomplete-results');
            const noResults = document.getElementById('journal-autocomplete-no-results');
            const dropdown = document.getElementById('journal-autocomplete');


            if (loading) loading.classList.add('hidden');

            if (results.length === 0) {
                if (resultsContainer) resultsContainer.classList.add('hidden');
                // Don't show no-results message if data exists
                if (noResults) noResults.classList.add('hidden');
            } else {
                if (noResults) noResults.classList.add('hidden');
                if (resultsContainer) {
                    resultsContainer.innerHTML = '';
                    resultsContainer.classList.remove('hidden');

                    results.forEach((item, index) => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'autocomplete-item px-3 py-2 text-sm cursor-pointer hover:bg-gray-100 border-b border-gray-100 last:border-b-0';
                        itemElement.dataset.key = item.key;
                        itemElement.dataset.source = item.source;
                        
                        if (index === 0) {
                            itemElement.classList.add('active');
                        }

                        itemElement.innerHTML = `
                            <div class="font-medium text-gray-900 truncate text-xs" title="${item.title}">
                                ${item.title}
                            </div>
                        `;

                        itemElement.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            selectAutocompleteItem(itemElement);
                        });

                        resultsContainer.appendChild(itemElement);
                    });
                }
            }

            if (dropdown) {
                // Only show dropdown if there are results
                if (results.length > 0) {
                    dropdown.classList.remove('hidden');
                } else {
                    dropdown.classList.add('hidden');
                }
            } else {
            }
        }

        // Select autocomplete item
        function selectAutocompleteItem(itemElement) {
            
            const key = itemElement.dataset.key;
            const source = itemElement.dataset.source;
            const selectedData = autocompleteData[key];


            if (!selectedData) {
                return;
            }

            // Fill the journal link field (REPLACE the current value)
            const journalLinkField = document.getElementById('journal_link');
            if (journalLinkField) {
                // Try different possible field names for journal link
                const journalLink = selectedData.doc_link || 
                                  selectedData.journal_link || 
                                  selectedData.journalLink || 
                                  selectedData.link || 
                                  selectedData.url || 
                                  selectedData.journal_url ||
                                  selectedData.paper_link ||
                                  selectedData.doi ||
                                  selectedData.article_link;
                
                if (journalLink) {
                    journalLinkField.value = journalLink;
                    
                    // Store journal title for later use in display
                    journalLinkField.dataset.journalTitle = selectedData.title || '';
                    
                    // Trigger input event to show the change
                    journalLinkField.dispatchEvent(new Event('input', { bubbles: true }));
                } else {
                    
                    // Show user-friendly message
                    showToast('Data dipilih tetapi tidak memiliki link jurnal', 'warning');
                }
            } else {
            }


            // Hide autocomplete dropdown
            hideAutocomplete();
            
        }

        // Hide autocomplete dropdown
        function hideAutocomplete() {
            const dropdown = document.getElementById('journal-autocomplete');
            if (dropdown) {
                dropdown.classList.add('hidden');
            }
        }



        // DOM Elements - will be initialized after DOM is loaded
        let tableBody = null;
        let researchModal = null;
        let modalTitle = null;
        let closeResearchModal = null;
        let addResearchBtn = null;
        let cancelBtn = null;
        let deleteConfirmModal = null;
        let confirmDeleteBtn = null;
        let cancelDeleteBtn = null;
        let researchForm = null;
        let submitBtn = null;
        
        // VLookup DOM Elements
        // vlookupJournalBtn removed
        
        // Autocomplete variables
        let autocompleteData = {};
        let autocompleteTimeout = null;
        

        let allData = {}; // To store the fetched data globally
        let keyToDelete = null; // To store key for deletion confirmation
        
        // Pagination variables
        let currentPage = 1;
        let itemsPerPage = 10;
        
        


        // --- Data Fetching and Table Population ---
        // Moved to loadResearchData() function above

        // --- Event Delegation for Table Actions ---
        // Moved to setupEventListeners() function above

        

         
        // --- Modal Functionality ---
        // Event listeners moved to setupEventListeners() function above
        

        function showResearchModal(mode, key = null, data = null) {
            if (!modalTitle || !submitBtn || !researchModal) {
                return;
            }
            
            if (mode === 'add') {
                modalTitle.textContent = 'Tambah Penelitian Baru';
                submitBtn.textContent = 'Tambah Penelitian';
                submitBtn.className = 'inline-flex justify-center py-1.5 px-3 border border-transparent shadow-sm text-xs font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500';
                resetFormToDefault();
            } else if (mode === 'edit') {
                modalTitle.textContent = 'Edit Penelitian';
                submitBtn.textContent = 'Update Penelitian';
                submitBtn.className = 'inline-flex justify-center py-1.5 px-3 border border-transparent shadow-sm text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500';
                setupEditForm(key, data);
            }
            
            researchModal.classList.remove('hidden');
        }
        
        function hideResearchModal() {
            if (researchModal) {
                researchModal.classList.add('hidden');
            }
            if (researchForm) {
                resetFormToDefault();
            }
        }

        function showDeleteConfirmModal(key) {
            keyToDelete = key;
            if (deleteConfirmModal) {
                deleteConfirmModal.classList.remove('hidden');
            }
        }
        function hideDeleteConfirmModal() {
            keyToDelete = null;
            if (deleteConfirmModal) {
                deleteConfirmModal.classList.add('hidden');
            }
        }



        // --- Form and CRUD Logic ---
        
        // Function to format currency input
        function formatCurrency(input) {
            // Remove all non-numeric characters
            let value = input.value.replace(/[^\d]/g, '');
            
            // If empty, set to empty string
            if (value === '') {
                input.value = '';
                return;
            }
            
            // Convert to number and format with thousand separators
            const number = parseInt(value);
            const formatted = number.toLocaleString('id-ID');
            
            // Update input value with formatted number
            input.value = formatted;
        }
        
        // Function to get numeric value from formatted currency
        function getNumericValue(formattedValue) {
            return formattedValue.replace(/[^\d]/g, '');
        }
        
        window.formatCurrency = formatCurrency;
        
                 function setupEditForm(key, data) {
             if (!researchForm) return;
             
             const editKeyField = researchForm.querySelector('#edit-key');
             if (editKeyField) editKeyField.value = key;
             
             const lecturerNameField = researchForm.querySelector('#lecturer_name');
             if (lecturerNameField) lecturerNameField.value = data.lecturer_name || '';
             
             const titleField = researchForm.querySelector('#title');
             if (titleField) titleField.value = data.title || '';
             
             const implementationPeriodField = researchForm.querySelector('#implementation_period');
             if (implementationPeriodField) implementationPeriodField.value = data.implementation_period || '';
             
             const journalDetailsField = researchForm.querySelector('#journal_details');
             if (journalDetailsField) journalDetailsField.value = data.journal_details || '';
             
             const journalLinkField = researchForm.querySelector('#journal_link');
             if (journalLinkField) {
                 journalLinkField.value = data.journal_link || '';
                 // Store journal title in dataset for later use
                 journalLinkField.dataset.journalTitle = data.journal_title || '';
             }
             
             const hkiDetailsField = researchForm.querySelector('#hki_details');
             if (hkiDetailsField) hkiDetailsField.value = data.hki_details || '';
             
             const hkiLinkField = researchForm.querySelector('#hki_link');
             if (hkiLinkField) hkiLinkField.value = data.hki_link || '';
             
             const mediaDetailsField = researchForm.querySelector('#media_details');
             if (mediaDetailsField) mediaDetailsField.value = data.media_details || '';
             
             const mediaLinkField = researchForm.querySelector('#media_link');
             if (mediaLinkField) mediaLinkField.value = data.media_link || '';
             
             const notesField = researchForm.querySelector('#notes');
             if (notesField) notesField.value = data.notes || '';
             
             const workFolderField = researchForm.querySelector('#work_folder');
             if (workFolderField) workFolderField.value = data.work_folder || '';
             
             // Format total_grant with thousand separators for display
             const totalGrantField = researchForm.querySelector('#total_grant');
             if (totalGrantField) {
                 const totalGrantValue = data.total_grant || '';
                 if (totalGrantValue) {
                     totalGrantField.value = parseInt(totalGrantValue).toLocaleString('id-ID');
                 } else {
                     totalGrantField.value = '';
                 }
             }
         }

                         function resetFormToDefault() {
            if (researchForm) {
                researchForm.reset();
                const editKeyField = researchForm.querySelector('#edit-key');
                if (editKeyField) {
                    editKeyField.value = '';
                }
            }
        }
        
        
        

        


        

        
        // --- Collapse Functions ---
        function toggleCollapse(key) {
            const collapseRow = document.getElementById(`collapse-${key}`);
            const viewBtn = document.querySelector(`[data-key="${key}"].view-btn`);
            
            if (collapseRow) {
                // Hide all other collapse rows first
                document.querySelectorAll('[id^="collapse-"]').forEach(row => {
                    if (row.id !== `collapse-${key}`) {
                        if (!row.classList.contains('hidden')) {
                            hideCollapse(row.id.replace('collapse-', ''));
                        }
                    }
                });
                
                // Toggle current collapse row
                if (collapseRow.classList.contains('hidden')) {
                    showCollapse(collapseRow, viewBtn);
                } else {
                    hideCollapse(key);
                }
            }
        }
        
        function showCollapse(collapseRow, viewBtn) {
            collapseRow.classList.remove('hidden');
            collapseRow.classList.add('expanded');
            
            if (viewBtn) {
                viewBtn.classList.add('expanded');
            }
        }
        
        function hideCollapse(key) {
            const collapseRow = document.getElementById(`collapse-${key}`);
            const viewBtn = document.querySelector(`[data-key="${key}"].view-btn`);
            if (collapseRow) {
                collapseRow.classList.add('hidden');
                collapseRow.classList.remove('expanded');
                
                if (viewBtn) {
                    viewBtn.classList.remove('expanded');
                }
            }
        }
        
        function showToast(message, type = 'success') {
            // Log ke console untuk debugging
            
            // Tampilkan alert untuk user
            if (type === 'error') {
                alert(` ${message}`);
            } else {
                alert(` ${message}`);
            }
        }
        
        // Function removed - using the main loadResearchData() function above
        
        // --- Pagination Functions ---
        function renderTableWithPagination(data) {
            if (!data || Object.keys(data).length === 0) {
                const emptyRow = `<tr><td colspan="4" class="px-6 py-8 text-center text-gray-400">
                    <div class="text-sm text-gray-400">Tidak ada data</div>
                </td></tr>`;
                tableBody.innerHTML = emptyRow;
                updatePaginationInfo(0, 0, 0);
                return;
            }
            
            // Convert data to array for pagination
            const dataArray = Object.entries(data);
            const totalItems = dataArray.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            // Ensure current page is valid
            if (currentPage > totalPages) {
                currentPage = totalPages;
            }
            if (currentPage < 1) {
                currentPage = 1;
            }
            
            // Get current page data
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPageData = dataArray.slice(startIndex, endIndex);
            
            // Clear table
            tableBody.innerHTML = '';
            
            // Render current page data
            currentPageData.forEach(([key, value]) => {
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-50', 'table-row');
                
                // Format each luaran type for display
                const formatLuaran = (details, link) => {
                    if (!details && !link) return '';
                    let display = details || '';
                    if (link) {
                        display += ` <a href="${link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline text-xs">[Link]</a>`;
                    }
                    return display;
                };

                // Format each luaran type for title (text only)
                const formatLuaranTitle = (details, link) => {
                    if (!details && !link) return '';
                    let display = details || '';
                    if (link) {
                        display += ` [Link]`;
                    }
                    return display;
                };
                
                row.innerHTML = `
                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-gray-300 text-center">${value.lecturer_name || ''}</td>
                    <td class="px-3 py-3 border-r border-gray-300">
                        <div class="text-xs font-medium text-gray-800" title="${value.title || ''}">${value.title || ''}</div>
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-gray-300 text-center">${value.implementation_period || ''}</td>
                    <td class="px-2 py-2 whitespace-nowrap text-xs font-medium action-column">
                        <div class="flex items-center justify-center space-x-1">
                            <button data-key="${key}" class="fresh-button view-btn text-gray-500" title="View"><i class="fas fa-chevron-down"></i></button>
                            <button data-key="${key}" class="fresh-button edit-btn text-gray-500" title="Edit"><i class="fas fa-pencil-alt"></i></button>
                            <button data-key="${key}" class="fresh-button delete-btn text-gray-500" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
                
                // Add collapse row for details
                const collapseRow = document.createElement('tr');
                collapseRow.id = `collapse-${key}`;
                collapseRow.classList.add('hidden', 'bg-gray-50', 'collapse-transition');
                
                // Format total_grant with thousand separators for display
                const totalGrantValue = value.total_grant || '';
                const formattedTotalGrant = totalGrantValue ? parseInt(totalGrantValue).toLocaleString('id-ID') : '';
                
                collapseRow.innerHTML = `
                    <td colspan="4" class="px-6 py-4">
                        <div class="border border-gray-300 p-4 bg-gray-100">
                            <h4 class="text-sm font-semibold text-gray-700 mb-4">Detail Penelitian</h4>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <!-- Link Jurnal -->
                                <div class="border border-gray-300 px-3 py-2 bg-white rounded">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 text-xs">Link Jurnal:</span>
                                        ${value.journal_link ? 
                                            `<a href="${value.journal_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline ml-2 text-xs">[LINK]</a>` : 
                                            '<span class="text-gray-400 ml-2 text-xs">-</span>'
                                        }
                                    </div>
                                </div>
                                
                                <!-- Link HKI -->
                                <div class="border border-gray-300 px-3 py-2 bg-white rounded">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 text-xs">Link HKI:</span>
                                        ${value.hki_link ? 
                                            `<a href="${value.hki_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline ml-2 text-xs">[LINK]</a>` : 
                                            '<span class="text-gray-400 ml-2 text-xs">-</span>'
                                        }
                                    </div>
                                </div>
                                
                                <!-- Link Media Massa -->
                                <div class="border border-gray-300 px-3 py-2 bg-white rounded">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 text-xs">Link Media Massa:</span>
                                        ${value.media_link ? 
                                            `<a href="${value.media_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline ml-2 text-xs">[LINK]</a>` : 
                                            '<span class="text-gray-400 ml-2 text-xs">-</span>'
                                        }
                                    </div>
                                </div>
                                
                                <!-- Total Hibah -->
                                <div class="border border-gray-300 px-3 py-2 bg-white rounded">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 text-xs">Total Hibah:</span>
                                        <span class="text-gray-700 ml-2 text-xs">${formattedTotalGrant ? 'Rp ' + formattedTotalGrant : '-'}</span>
                                    </div>
                                </div>
                                
                                <!-- Folder Kerja -->
                                <div class="border border-gray-300 px-3 py-2 bg-white rounded">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 text-xs">Folder Kerja:</span>
                                        <span class="text-gray-700 ml-2 text-xs">${value.work_folder || '-'}</span>
                                    </div>
                                </div>
                                
                                <!-- Catatan -->
                                <div class="border border-gray-300 px-3 py-2 bg-white rounded md:col-span-3">
                                    <div class="flex items-start">
                                        <span class="font-medium text-gray-600 text-xs">Catatan:</span>
                                        <span class="text-gray-700 ml-2 text-xs whitespace-pre-wrap">${value.notes || '-'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(collapseRow);
            });
            
            // Update pagination
            updatePaginationInfo(startIndex + 1, endIndex, totalItems);
            renderPageNumbers(totalPages);
            updateNavigationButtons(totalPages);
        }
        
        function updatePaginationInfo(start, end, total) {
            const pageInfo = document.getElementById('page-info');
            if (total === 0) {
                pageInfo.textContent = 'Tidak ada data';
            } else {
                pageInfo.textContent = `Menampilkan ${start}-${Math.min(end, total)} dari ${total} data`;
            }
        }
        
        function renderPageNumbers(totalPages) {
            const pageNumbersContainer = document.getElementById('page-numbers');
            pageNumbersContainer.innerHTML = '';
            
            if (totalPages <= 1) {
                return;
            }
            
            // Tampilkan semua nomor halaman
            for (let i = 1; i <= totalPages; i++) {
                    addPageNumber(i);
            }
        }
        
        function addPageNumber(pageNum, type = 'number') {
            const pageNumbersContainer = document.getElementById('page-numbers');
            const pageBtn = document.createElement('button');
            
                pageBtn.textContent = pageNum;
                pageBtn.className = `fresh-pagination-btn ${pageNum === currentPage ? 'active' : ''}`;
                pageBtn.addEventListener('click', () => goToPage(pageNum));
            
            pageNumbersContainer.appendChild(pageBtn);
        }
        
        function updateNavigationButtons(totalPages) {
            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
        }
        
        function goToPage(page) {
            currentPage = page;
            renderTableWithPagination(allData);
        }
        
        function goToPreviousPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }
        
        function goToNextPage() {
            const totalPages = Math.ceil(Object.keys(allData).length / itemsPerPage);
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        }
        
        function changeItemsPerPage(newItemsPerPage) {
            itemsPerPage = parseInt(newItemsPerPage);
            currentPage = 1; // Reset to first page
            renderTableWithPagination(allData);
        }

        
        // ===== FILTER AND SEARCH FUNCTIONALITY =====
        
        // Setup filter event listeners
        function setupFilterEventListeners() {
            // Desktop filter elements
            const titleSearch = document.getElementById('title-search');
            const yearFilter = document.getElementById('year-filter');
            
            // Mobile filter elements
            const mobileTitleSearch = document.getElementById('mobile-title-search');
            const mobileYearFilter = document.getElementById('mobile-year-filter');
            
            // Mobile filter toggle
            const mobileFilterToggle = document.getElementById('mobile-filter-toggle');
            const mobileFilterSidebar = document.getElementById('mobile-filter-sidebar');
            const mobileFilterClose = document.getElementById('mobile-filter-close');
            const mobileFilterIcon = document.getElementById('mobile-filter-icon');
            
            // Desktop search event listeners
            if (titleSearch) {
                titleSearch.addEventListener('input', applyFilters);
            }
            
            if (yearFilter) {
                yearFilter.addEventListener('change', applyFilters);
            }
            
            // Mobile search event listeners
            if (mobileTitleSearch) {
                mobileTitleSearch.addEventListener('input', (e) => {
                    // Sync with desktop
                    if (titleSearch) {
                        titleSearch.value = e.target.value;
                    }
                    applyFilters();
                });
            }
            
            if (mobileYearFilter) {
                mobileYearFilter.addEventListener('change', (e) => {
                    // Sync with desktop
                    if (yearFilter) {
                        yearFilter.value = e.target.value;
                    }
                    applyFilters();
                });
            }
            
            // Mobile filter sidebar toggle
            if (mobileFilterToggle) {
                mobileFilterToggle.addEventListener('click', () => {
                    mobileFilterSidebar.classList.remove('translate-x-full');
                    mobileFilterIcon.classList.remove('fa-chevron-right');
                    mobileFilterIcon.classList.add('fa-chevron-left');
                });
            }
            
            if (mobileFilterClose) {
                mobileFilterClose.addEventListener('click', () => {
                    mobileFilterSidebar.classList.add('translate-x-full');
                    mobileFilterIcon.classList.remove('fa-chevron-left');
                    mobileFilterIcon.classList.add('fa-chevron-right');
                });
            }
            
            // Close mobile sidebar when clicking outside
            document.addEventListener('click', (e) => {
                if (mobileFilterSidebar && !mobileFilterSidebar.contains(e.target) && !mobileFilterToggle.contains(e.target)) {
                    mobileFilterSidebar.classList.add('translate-x-full');
                    mobileFilterIcon.classList.remove('fa-chevron-left');
                    mobileFilterIcon.classList.add('fa-chevron-right');
                }
            });
        }
        
        // Apply filters function
        function applyFilters() {
            // Reset to first page when filtering
            currentPage = 1;
            
            // Get current search terms
            const titleSearchTerm = document.getElementById('title-search')?.value.toLowerCase().trim() || '';
            
            // Get filter values
            const yearFilter = document.getElementById('year-filter')?.value || '';
            
            // Ensure we have valid data to filter
            if (!allData || Object.keys(allData).length === 0) {
                renderTableWithPagination({});
                return;
            }
            
            // Apply all filters and search
            let filteredData = {};
            
            Object.entries(allData).forEach(([key, value]) => {
                if (!value) return; // Skip invalid entries
                
                let matches = true;
                
                // Search by Title
                if (titleSearchTerm && !value.title?.toLowerCase().includes(titleSearchTerm)) {
                    matches = false;
                }
                
                // Filter by Year
                if (yearFilter && value.implementation_period?.toString() !== yearFilter) {
                    matches = false;
                }
                
                if (matches) {
                    filteredData[key] = value;
                }
            });
            
            // Render filtered data
            renderTableWithPagination(filteredData);
        }
        

        // ===== DEBUG FUNCTIONS =====

        // ===== JOURNAL PREVIEW FUNCTIONS =====
        // Functions removed - now using direct hyperlinks

        // Event listener removed - modal no longer used

    </script>

    <!-- Modal removed - now using direct hyperlinks -->

    <!-- Footer -->
    <footer class="bg-gray-100 py-4 mt-8">
    </footer>
</body>
</html>